import os import numpy as np import matplotlib . pyplot as plt import matplotlib . gridspec as gridspec import matplotlib . colors import matplotlib . patches as patches from scipy import stats from jaratoolbox import settings from jaratoolbox import extraplots import figparams reload ( figparams ) FIGNAME = <str> dataDir = os . path . join ( settings . FIGURES_DATA_PATH , figparams . STUDY_NAME , FIGNAME ) PANELS = [ 1 , 1 , 1 , 1 , 1 ] SAVE_FIGURE = 1 outputDir = <str> figFilename = <str> figFormat = <str> figSize = [ 9 , 10 ] fontSizeLabels = figparams . fontSizeLabels fontSizeTicks = figparams . fontSizeTicks fontSizePanel = figparams . fontSizePanel fontSizeLegend = figparams . fontSizeLegend labelPosX = [ 0.01 , 0.3 , 0.63 , 0.37 , 0.61 ] labelPosY = [ 0.98 , 0.66 , 0.32 ] ExcColour = figparams . colp [ <str> ] Exclight = matplotlib . colors . colorConverter . to_rgba ( ExcColour , alpha = 0.5 ) PVcolour = figparams . colp [ <str> ] PVlight = matplotlib . colors . colorConverter . to_rgba ( PVcolour , alpha = 0.5 ) SOMcolour = figparams . colp [ <str> ] SOMlight = matplotlib . colors . colorConverter . to_rgba ( SOMcolour , alpha = 0.5 ) laserColour = figparams . colp [ <str> ] soundColour = figparams . colp [ <str> ] fig = plt . gcf ( ) fig . clf ( ) fig . set_facecolor ( <str> ) gs = gridspec . GridSpec ( 3 , 3 , width_ratios = [ 0.8 , 0.8 , 1.1 ] , height_ratios = [ 1 , 1 , 0.9 ] ) gs . update ( top = 0.98 , left = 0.1 , right = 0.95 , bottom = 0.08 , wspace = 0.4 , hspace = 0.3 ) exampleNoSOM = <str> exampleNoPV = <str> summaryFileName = <str> def bootstrap_median_CI ( data , reps = 1000 , interval = 95 ) :      medians = np . zeros ( reps ) for ind in range ( reps ) :          samples = np . random . choice ( data , len ( data ) , replace = True ) medians [ ind ] = np . median ( samples )  low = np . percentile ( medians , ( 100 - interval ) / 2.0 ) high = np . percentile ( medians , interval + ( 100 - interval ) / 2.0 ) return [ low , high ]  if PANELS [ 0 ] :      exampleCells = [ exampleNoPV , exampleNoSOM ] cellColours = [ [ PVcolour , PVlight ] , [ SOMcolour , SOMlight ] ] panelLabels = [ <str> , <str> ] for indCell , cell in enumerate ( exampleCells ) :          axRaster = gs [ indCell , 1 ] exampleDataFullPath = os . path . join ( dataDir , cell ) exampleData = np . load ( exampleDataFullPath ) colours = [ [ ExcColour , Exclight ] , cellColours [ indCell ] ] possibleBands = exampleData [ <str> ] bandLabels = possibleBands . tolist ( ) bandLabels [ - 1 ] = <str> laserTrials = exampleData [ <str> ] inner = gridspec . GridSpecFromSubplotSpec ( 2 , 1 , subplot_spec = axRaster , wspace = 0.1 , hspace = 0.25 ) for laser in laserTrials :              thisAx = plt . subplot ( inner [ laser , 0 ] ) colorEachCond = colours [ laser ] * ( len ( possibleBands ) / 2 + 1 ) pRaster , hcond , zline = extraplots . raster_plot ( exampleData [ <str> ] , exampleData [ <str> ] , exampleData [ <str> ] , trialsEachCond = exampleData [ <str> ] [ : , 1 : , laser ] , labels = bandLabels [ 1 : ] , colorEachCond = colorEachCond ) plt . setp ( pRaster , ms = 3 ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) yLims = np . array ( plt . ylim ( ) ) soundPatch = patches . Rectangle ( ( 0.0 , yLims [ 1 ] * 1.03 ) , 1.0 , yLims [ 1 ] * 0.05 , linewidth = 1 , edgecolor = soundColour , facecolor = soundColour , clip_on = False ) thisAx . add_patch ( soundPatch ) if not laser :                  thisAx . set_xticklabels ( <str> )  else :                  laserPatch = patches . Rectangle ( ( - 0.1 , yLims [ 1 ] * 1.11 ) , 1.3 , yLims [ 1 ] * 0.05 , linewidth = 1 , edgecolor = laserColour , facecolor = laserColour , clip_on = False ) thisAx . add_patch ( laserPatch )   plt . xlabel ( <str> , fontsize = fontSizeLabels ) thisAx . annotate ( panelLabels [ indCell ] , xy = ( labelPosX [ 1 ] , labelPosY [ indCell ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> )  cartoonPanels = [ <str> , <str> ] for indPanel , panel in enumerate ( cartoonPanels ) :          thisAx . annotate ( panel , xy = ( labelPosX [ 0 ] , labelPosY [ indPanel ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> )   if PANELS [ 1 ] :      exampleCells = [ exampleNoPV , exampleNoSOM ] figLegends = [ <str> , <str> ] excColour = figparams . colp [ <str> ] PVcolour = figparams . colp [ <str> ] SOMcolour = figparams . colp [ <str> ] colours = [ [ excColour , PVcolour ] , [ excColour , SOMcolour ] ] lineType = [ <str> , <str> ] panelLabels = [ <str> , <str> ] legendLocs = [ <str> , <str> ] for indCell , cell in enumerate ( exampleCells ) :          exampleDataFullPath = os . path . join ( dataDir , cell ) exampleData = np . load ( exampleDataFullPath ) sustainedResponseArray = exampleData [ <str> ] sustainedSEM = exampleData [ <str> ] baseline = sustainedResponseArray [ 0 ] bands = exampleData [ <str> ] laserTrials = exampleData [ <str> ] bandLabels = [ <str> . format ( band ) for band in np . unique ( possibleBands ) ] fitBands = exampleData [ <str> ] fitResponseNoLaser = exampleData [ <str> ] fitResponseLaser = exampleData [ <str> ] fits = [ fitResponseNoLaser , fitResponseLaser ] lines = [ ] SIs = [ float ( exampleData [ <str> ] ) , float ( exampleData [ <str> ] ) ] print <str> . format ( figLegends [ indCell ] , SIs ) plt . hold ( 1 ) axCurve = plt . subplot ( gs [ indCell , 2 ] ) axCurve . set_xscale ( <str> , basex = 2 ) for laser in laserTrials :              thisResponse = sustainedResponseArray [ : , laser ] . flatten ( ) thisSEM = sustainedSEM [ : , laser ] . flatten ( ) plt . plot ( bands [ 1 : ] , thisResponse [ 1 : ] , <str> , ms = 5 , color = colours [ indCell ] [ laser ] , mec = colours [ indCell ] [ laser ] , clip_on = False ) plt . errorbar ( bands [ 1 : ] , thisResponse [ 1 : ] , yerr = [ thisSEM [ 1 : ] , thisSEM [ 1 : ] ] , fmt = <str> , ecolor = colours [ indCell ] [ laser ] ) line , = plt . plot ( fitBands , fits [ laser ] , lineType [ laser ] , lw = 1.5 , color = colours [ indCell ] [ laser ] ) lines . append ( line )  plt . legend ( [ lines [ - 1 ] , lines [ 0 ] ] , [ figLegends [ indCell ] , <str> ] , loc = legendLocs [ indCell ] , frameon = False , fontsize = fontSizeLegend , borderpad = 2.0 ) axCurve . annotate ( panelLabels [ indCell ] , xy = ( labelPosX [ 2 ] , labelPosY [ indCell ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) axCurve . set_ylim ( bottom = 0 ) axCurve . set_xticks ( bands [ 1 : ] ) axCurve . tick_params ( top = False , right = False , which = <str> ) extraplots . boxoff ( axCurve ) extraplots . set_ticks_fontsize ( plt . gca ( ) , fontSizeTicks ) bands = bands . tolist ( ) bands [ - 1 ] = <str> axCurve . set_xticklabels ( bands [ 1 : ] ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) plt . xlim ( 0.2 , 7 )   axSummaries = gs [ 2 , : ] gs2 = gridspec . GridSpecFromSubplotSpec ( 1 , 3 , subplot_spec = axSummaries , wspace = 0.5 , hspace = 0.2 , width_ratios = [ 1 , 0.4 , 1 ] ) if PANELS [ 2 ] :      summaryDataFullPath = os . path . join ( dataDir , summaryFileName ) summaryData = np . load ( summaryDataFullPath ) PVsustainedSuppressionNoLaser = summaryData [ <str> ] PVsustainedSuppressionLaser = summaryData [ <str> ] SOMsustainedSuppressionNoLaser = summaryData [ <str> ] SOMsustainedSuppressionLaser = summaryData [ <str> ] PVsupNoLaser = summaryData [ <str> ] PVsupLaser = summaryData [ <str> ] semPVsupNoLaser = summaryData [ <str> ] semPVsupLaser = summaryData [ <str> ] SOMsupNoLaser = summaryData [ <str> ] SOMsupLaser = summaryData [ <str> ] semSOMsupNoLaser = summaryData [ <str> ] semSOMsupLaser = summaryData [ <str> ] panelLabel = <str> cellLabels = [ <str> , <str> ] cellTypeColours = [ PVcolour , SOMcolour ] axScatter = plt . subplot ( gs2 [ 0 , 0 ] ) plt . hold ( True ) plt . plot ( [ - 2 , 2 ] , [ - 2 , 2 ] , <str> ) l2 , = plt . plot ( SOMsustainedSuppressionNoLaser , SOMsustainedSuppressionLaser , <str> , color = <str> , mec = SOMcolour , ms = 3.2 , markeredgewidth = 1.2 ) l1 , = plt . plot ( PVsustainedSuppressionNoLaser , PVsustainedSuppressionLaser , <str> , color = PVcolour , mec = <str> , ms = 4 ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . xlim ( - 0.1 , 1.1 ) plt . ylim ( - 0.1 , 1.1 ) plt . legend ( [ l1 , l2 ] , cellLabels , loc = <str> , fontsize = fontSizeLegend , numpoints = 1 , handlelength = 0.3 , markerscale = 1.7 , frameon = False , ) extraplots . boxoff ( axScatter ) axScatter . set ( adjustable = <str> , aspect = <str> ) axScatter . annotate ( panelLabel , xy = ( labelPosX [ 0 ] , labelPosY [ 2 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) noPV = stats . wilcoxon ( PVsustainedSuppressionNoLaser , PVsustainedSuppressionLaser ) [ 1 ] noSOM = stats . wilcoxon ( SOMsustainedSuppressionNoLaser , SOMsustainedSuppressionLaser ) [ 1 ] print <str> . format ( noPV , noSOM )  if PANELS [ 3 ] :      summaryDataFullPath = os . path . join ( dataDir , summaryFileName ) summaryData = np . load ( summaryDataFullPath ) PVsustainedSuppressionNoLaser = summaryData [ <str> ] PVsustainedSuppressionLaser = summaryData [ <str> ] SOMsustainedSuppressionNoLaser = summaryData [ <str> ] SOMsustainedSuppressionLaser = summaryData [ <str> ] noPVsupDiff = PVsustainedSuppressionLaser - PVsustainedSuppressionNoLaser noSOMsupDiff = SOMsustainedSuppressionLaser - SOMsustainedSuppressionNoLaser panelLabel = <str> cellLabels = [ <str> , <str> ] cellTypeColours = [ PVcolour , SOMcolour ] supDiffs = [ noPVsupDiff , noSOMsupDiff ] axBox = plt . subplot ( gs2 [ 0 , 1 ] ) width = 0.7 loc = np . arange ( 1 , 3 ) SIMedians = [ np . median ( noPVsupDiff ) , np . median ( noSOMsupDiff ) ] SICIs = [ bootstrap_median_CI ( noPVsupDiff ) , bootstrap_median_CI ( noSOMsupDiff ) ] for indType in range ( len ( SIMedians ) ) :          plt . plot ( [ loc [ indType ] - width / 2 , loc [ indType ] + width / 2 ] , [ SIMedians [ indType ] , SIMedians [ indType ] ] , color = cellTypeColours [ indType ] , linewidth = 3 ) plt . plot ( [ loc [ indType ] , loc [ indType ] ] , SICIs [ indType ] , color = cellTypeColours [ indType ] , linewidth = 1.5 ) plt . plot ( [ loc [ indType ] - width / 8 , loc [ indType ] + width / 8 ] , [ SICIs [ indType ] [ 0 ] , SICIs [ indType ] [ 0 ] ] , color = cellTypeColours [ indType ] , linewidth = 1.5 ) plt . plot ( [ loc [ indType ] - width / 8 , loc [ indType ] + width / 8 ] , [ SICIs [ indType ] [ 1 ] , SICIs [ indType ] [ 1 ] ] , color = cellTypeColours [ indType ] , linewidth = 1.5 )  plt . plot ( [ - 5 , 5 ] , [ 0 , 0 ] , <str> , zorder = - 10 ) axBox . set_xticks ( [ 1 , 2 ] ) axBox . set_xticklabels ( cellLabels ) plt . xlim ( 0.4 , 2.6 ) axBox . set_xticks ( range ( 1 , len ( supDiffs ) + 1 ) ) axBox . set_xticklabels ( cellLabels , fontsize = fontSizeLabels , rotation = - 45 ) yLims = ( - 0.2 , 0.1 ) plt . ylim ( yLims ) extraplots . significance_stars ( [ 1 , 2 ] , yLims [ 1 ] * 0.92 , yLims [ 1 ] * 0.07 , gapFactor = 0.2 ) extraplots . boxoff ( axBox ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) axBox . annotate ( panelLabel , xy = ( labelPosX [ 3 ] , labelPosY [ 2 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) pVal = stats . ranksums ( noPVsupDiff , noSOMsupDiff ) [ 1 ] print <str> . format ( pVal )  if PANELS [ 4 ] :      summaryDataFullPath = os . path . join ( dataDir , summaryFileName ) summaryData = np . load ( summaryDataFullPath ) PVpeakChangeFR = summaryData [ <str> ] PVWNChangeFR = summaryData [ <str> ] SOMpeakChangeFR = summaryData [ <str> ] SOMWNChangeFR = summaryData [ <str> ] PVpeakChange = summaryData [ <str> ] PVWNChange = summaryData [ <str> ] semPVpeakChange = summaryData [ <str> ] semPVWNChange = summaryData [ <str> ] SOMpeakChange = summaryData [ <str> ] SOMWNChange = summaryData [ <str> ] semSOMpeakChange = summaryData [ <str> ] semSOMWNChange = summaryData [ <str> ] panelLabel = <str> cellLabels = [ <str> , <str> ] PVcolour = figparams . colp [ <str> ] SOMcolour = figparams . colp [ <str> ] cellTypeColours = [ PVcolour , SOMcolour ] axScatter = plt . subplot ( gs2 [ 0 , 2 ] ) plt . hold ( True ) plt . plot ( [ - 20 , 30 ] , [ - 20 , 30 ] , <str> ) l2 , = plt . plot ( SOMpeakChangeFR , SOMWNChangeFR , <str> , color = <str> , mec = SOMcolour , ms = 3.2 , markeredgewidth = 1.2 ) l1 , = plt . plot ( PVpeakChangeFR , PVWNChangeFR , <str> , color = PVcolour , mec = <str> , ms = 4 ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . xlim ( - 5 , 8 ) plt . ylim ( - 5 , 8 ) plt . legend ( [ l1 , l2 ] , cellLabels , loc = <str> , fontsize = fontSizeLegend , numpoints = 1 , handlelength = 0.3 , markerscale = 1.7 , frameon = False , ) axScatter . annotate ( panelLabel , xy = ( labelPosX [ 4 ] , labelPosY [ 2 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) extraplots . boxoff ( axScatter ) axScatter . set ( adjustable = <str> , aspect = <str> ) noPV = stats . wilcoxon ( PVpeakChangeFR , PVWNChangeFR ) [ 1 ] noSOM = stats . wilcoxon ( SOMpeakChangeFR , SOMWNChangeFR ) [ 1 ] print <str> . format ( noPV , noSOM )  if SAVE_FIGURE :      extraplots . save_figure ( figFilename , figFormat , figSize , outputDir )    