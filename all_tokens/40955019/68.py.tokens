import os import numpy as np from matplotlib import pyplot as plt from jaratoolbox import colorpalette as cp from jaratoolbox import extraplots from jaratoolbox import settings from jaratoolbox import loadbehavior from jaratoolbox import behavioranalysis import matplotlib . gridspec as gridspec import matplotlib import matplotlib . patches as mpatches import matplotlib . lines as mlines import scipy . stats as stats import figparams reload ( figparams ) FIGNAME = <str> dataDir = os . path . join ( settings . FIGURES_DATA_PATH , figparams . STUDY_NAME , FIGNAME ) matplotlib . rcParams [ <str> ] = <str> matplotlib . rcParams [ <str> ] = <str> colorLeft = figparams . colp [ <str> ] colorRight = figparams . colp [ <str> ] soundColor = figparams . colp [ <str> ] timeRange = [ - 0.3 , 0.5 ] PANELS = [ 1 , 1 , 1 ] SAVE_FIGURE = 1 outputDir = <str> figFilename = <str> figFormat = <str> figSize = [ 7 , 7 ] fontSizeLabels = figparams . fontSizeLabels fontSizeTicks = figparams . fontSizeTicks fontSizePanel = figparams . fontSizePanel labelDis = 0.1 labelPosX = [ 0.02 , 0.54 ] labelPosY = [ 0.95 , 0.67 , 0.48 , 0.35 ] fig = plt . gcf ( ) fig . clf ( ) fig . set_facecolor ( <str> ) gs = gridspec . GridSpec ( 6 , 2 ) gs . update ( left = 0.14 , right = 0.98 , top = 0.95 , bottom = 0.1 , wspace = 0.5 , hspace = 1.5 ) gs01 = gridspec . GridSpecFromSubplotSpec ( 3 , 3 , subplot_spec = gs [ 0 : 3 , 1 ] , hspace = 0.15 ) gs02 = gridspec . GridSpecFromSubplotSpec ( 3 , 3 , subplot_spec = gs [ 3 : , 1 ] , hspace = 0.15 ) msRaster = 2 msMvStart = 3 smoothWinSizePsth = 2 lwPsth = 2 downsampleFactorPsth = 1 ax1 = plt . subplot ( gs [ 0 : 2 , 0 ] ) plt . axis ( <str> ) ax1 . annotate ( <str> , xy = ( labelPosX [ 0 ] , labelPosY [ 0 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) ax2 = plt . subplot ( gs [ 2 : 4 , 0 ] ) ax1 . annotate ( <str> , xy = ( labelPosX [ 0 ] , labelPosY [ 1 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) animal = <str> paradigm = <str> session = <str> winsize = 40 behavFileName = loadbehavior . path_to_behavior_data ( animal , paradigm , session ) behavData = loadbehavior . FlexCategBehaviorData ( behavFileName ) hPlots = behavioranalysis . plot_dynamics_2afc_by_freq ( behavData , winsize = winsize , fontsize = fontSizeLabels , soundfreq = None ) extraplots . boxoff ( plt . gca ( ) ) plt . setp ( hPlots [ 1 ] , color = colorLeft ) plt . setp ( hPlots [ 2 ] , color = <str> ) plt . setp ( hPlots [ 3 ] , color = <str> ) plt . setp ( hPlots [ 4 ] , color = colorRight ) plt . setp ( hPlots [ 8 ] , color = <str> ) plt . setp ( hPlots [ 7 ] , color = colorLeft ) plt . setp ( hPlots [ 9 ] , color = <str> ) plt . setp ( hPlots [ 10 ] , color = colorRight ) plt . xlim ( [ 0 , 740 ] ) plt . xticks ( [ 0 , 200 , 400 , 600 ] ) plt . yticks ( [ 0 , 50 , 100 ] ) plt . ylabel ( <str> , labelpad = 0.5 , fontsize = fontSizeLabels ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . text ( 30 , 38 , <str> , fontsize = fontSizeLabels ) plt . text ( 165 , 38 , <str> , fontsize = fontSizeLabels ) plt . text ( 255 , 38 , <str> , fontsize = fontSizeLabels ) plt . text ( 390 , 38 , <str> , fontsize = fontSizeLabels ) ax3 = plt . subplot ( gs02 [ 0 : 2 , : ] ) ax3 . annotate ( <str> , xy = ( labelPosX [ 1 ] , labelPosY [ 2 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) if PANELS [ 0 ] :      rasterFilename = <str> rasterFullPath = os . path . join ( dataDir , rasterFilename ) rasterExample = np . load ( rasterFullPath ) trialsEachCond = rasterExample [ <str> ] colorEachCond = [ colorLeft , colorRight , colorLeft , colorRight ] spikeTimesFromEventOnset = rasterExample [ <str> ] indexLimitsEachTrial = rasterExample [ <str> ] pRaster , hcond , zline = extraplots . raster_plot ( spikeTimesFromEventOnset , indexLimitsEachTrial , timeRange = timeRange , trialsEachCond = trialsEachCond , colorEachCond = colorEachCond ) plt . setp ( pRaster , ms = msRaster ) movementTimesFromEventOnset = rasterExample [ <str> ] trialsToUse = np . sum ( trialsEachCond , axis = 1 ) . astype ( <str> ) yLims = plt . gca ( ) . get_ylim ( ) plt . hold ( <str> ) bplot = plt . boxplot ( movementTimesFromEventOnset [ trialsToUse ] , sym = <str> , vert = False , positions = [ yLims [ - 1 ] + 10 ] , widths = [ 15 ] ) extraplots . boxoff ( plt . gca ( ) ) plt . autoscale ( enable = True , axis = <str> , tight = True ) plt . axis ( <str> ) for element in [ <str> , <str> , <str> , <str> ] :          plt . setp ( bplot [ element ] , color = <str> , linewidth = 1 )  plt . setp ( bplot [ <str> ] , linestyle = <str> ) plt . setp ( bplot [ <str> ] , color = <str> ) ax3 . set_yticklabels ( [ ] ) ax3 . set_xticklabels ( [ ] ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) ax3 = plt . subplot ( gs02 [ 2 , : ] ) psthFilename = <str> psthFullPath = os . path . join ( dataDir , psthFilename ) psthExample = np . load ( psthFullPath ) trialsEachCond = psthExample [ <str> ] spikeCountMat = psthExample [ <str> ] timeVec = psthExample [ <str> ] binWidth = psthExample [ <str> ] extraplots . plot_psth ( spikeCountMat / binWidth , smoothWinSizePsth , timeVec , trialsEachCond = trialsEachCond , colorEachCond = colorEachCond , linestyle = None , linewidth = lwPsth , downsamplefactor = downsampleFactorPsth ) plt . legend ( [ <str> , <str> ] , loc = <str> , fontsize = fontSizeTicks , handlelength = 0.2 , frameon = False , handletextpad = 0.3 , labelspacing = 0 , borderaxespad = 0 ) extraplots . set_ticks_fontsize ( plt . gca ( ) , fontSizeTicks ) plt . axvline ( x = 0 , linewidth = 1 , color = <str> ) plt . xlim ( timeRange ) yLims = [ 0 , 50 ] soundBarHeight = 0.1 * yLims [ - 1 ] plt . fill ( [ 0 , 0.1 , 0.1 , 0 ] , yLims [ - 1 ] + np . array ( [ 0 , 0 , soundBarHeight , soundBarHeight ] ) , ec = <str> , fc = soundColor , clip_on = False ) plt . ylim ( yLims ) plt . yticks ( yLims ) plt . xticks ( np . arange ( - 0.2 , 0.6 , 0.2 ) ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . ylabel ( <str> , fontsize = fontSizeLabels , labelpad = labelDis ) extraplots . boxoff ( plt . gca ( ) )  ax4 = plt . subplot ( gs01 [ 0 : 2 , : ] ) ax4 . annotate ( <str> , xy = ( labelPosX [ 1 ] , labelPosY [ 0 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) if PANELS [ 1 ] :      rasterFilename = <str> rasterFullPath = os . path . join ( dataDir , rasterFilename ) rasterExample = np . load ( rasterFullPath ) trialsEachCond = rasterExample [ <str> ] colorEachCond = [ colorLeft , colorRight , colorLeft , colorRight ] spikeTimesFromEventOnset = rasterExample [ <str> ] indexLimitsEachTrial = rasterExample [ <str> ] pRaster , hcond , zline = extraplots . raster_plot ( spikeTimesFromEventOnset , indexLimitsEachTrial , timeRange = timeRange , trialsEachCond = trialsEachCond , colorEachCond = colorEachCond , fillWidth = None , labels = None ) plt . setp ( pRaster , ms = msRaster ) movementTimesFromEventOnset = rasterExample [ <str> ] trialsToUse = np . sum ( trialsEachCond , axis = 1 ) . astype ( <str> ) yLims = plt . gca ( ) . get_ylim ( ) plt . hold ( <str> ) bplot = plt . boxplot ( movementTimesFromEventOnset [ trialsToUse ] , sym = <str> , vert = False , positions = [ yLims [ - 1 ] + 10 ] , widths = [ 15 ] ) extraplots . boxoff ( plt . gca ( ) ) plt . autoscale ( enable = True , axis = <str> , tight = True ) plt . axis ( <str> ) for element in [ <str> , <str> , <str> , <str> ] :          plt . setp ( bplot [ element ] , color = <str> , linewidth = 1 )  plt . setp ( bplot [ <str> ] , linestyle = <str> ) plt . setp ( bplot [ <str> ] , color = <str> ) ax4 . set_yticklabels ( [ ] ) ax4 . set_xticklabels ( [ ] ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) ax5 = plt . subplot ( gs01 [ 2 , : ] ) psthFilename = <str> psthFullPath = os . path . join ( dataDir , psthFilename ) psthExample = np . load ( psthFullPath ) trialsEachCond = psthExample [ <str> ] spikeCountMat = psthExample [ <str> ] timeVec = psthExample [ <str> ] binWidth = psthExample [ <str> ] pPSTH = extraplots . plot_psth ( spikeCountMat / binWidth , smoothWinSizePsth , timeVec , trialsEachCond = trialsEachCond , colorEachCond = colorEachCond , linestyle = None , linewidth = lwPsth , downsamplefactor = downsampleFactorPsth ) plt . setp ( pPSTH [ 1 ] , zorder = 3 ) plt . legend ( [ <str> , <str> ] , loc = <str> , bbox_to_anchor = ( 1 , 1.1 ) , fontsize = fontSizeTicks , handlelength = 0.2 , frameon = False , handletextpad = 0.3 , labelspacing = 0 , borderaxespad = 0 ) extraplots . set_ticks_fontsize ( plt . gca ( ) , fontSizeTicks ) plt . axvline ( x = 0 , linewidth = 1 , color = <str> ) yLims = [ 0 , 25 ] soundBarHeight = 0.1 * yLims [ - 1 ] plt . fill ( [ 0 , 0.1 , 0.1 , 0 ] , yLims [ - 1 ] + np . array ( [ 0 , 0 , soundBarHeight , soundBarHeight ] ) , ec = <str> , fc = soundColor , clip_on = False ) plt . xlim ( timeRange ) plt . ylim ( yLims ) plt . yticks ( yLims ) plt . xticks ( np . arange ( - 0.2 , 0.6 , 0.2 ) ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . ylabel ( <str> , fontsize = fontSizeLabels , labelpad = labelDis ) extraplots . boxoff ( plt . gca ( ) )  ax6 = plt . subplot ( gs [ 4 : , 0 ] ) ax6 . annotate ( <str> , xy = ( labelPosX [ 0 ] , labelPosY [ 3 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) if PANELS [ 2 ] :      colorMod = <str> colorNotMod = <str> summaryFilename = <str> summaryFullPath = os . path . join ( dataDir , summaryFilename ) summary = np . load ( summaryFullPath ) sigModulated = summary [ <str> ] sigMI = summary [ <str> ] [ sigModulated ] nonsigMI = summary [ <str> ] [ ~ sigModulated ] binsEdges = np . linspace ( - 1 , 1 , 20 ) plt . hist ( [ sigMI , nonsigMI ] , bins = binsEdges , color = [ colorMod , colorNotMod ] , edgecolor = <str> , stacked = True , rwidth = 0.8 ) yPosText = 0.95 * plt . ylim ( ) [ 1 ] plt . text ( - 0.5 , yPosText , <str> , ha = <str> , fontsize = fontSizeLabels ) plt . text ( 0.5 , yPosText , <str> , ha = <str> , fontsize = fontSizeLabels ) plt . axvline ( x = 0 , linestyle = <str> , linewidth = 1.5 , color = <str> ) extraplots . set_ticks_fontsize ( plt . gca ( ) , fontSizeTicks ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) extraplots . boxoff ( plt . gca ( ) )  plt . show ( ) if SAVE_FIGURE :      extraplots . save_figure ( figFilename , figFormat , figSize , outputDir )  print <str> , len ( sigModulated ) , <str> , sum ( sigModulated ) ( T , pVal ) = stats . wilcoxon ( summary [ <str> ] ) print <str> . format ( pVal )  