import numpy as np import scipy . optimize from jaratoolbox import behavioranalysis from jaratoolbox import loadbehavior from jaratoolbox import extraplots import matplotlib from matplotlib import pyplot as plt import figparams matplotlib . rcParams [ <str> ] = <str> matplotlib . rcParams [ <str> ] = <str> sessionsDict = { <str> : [ <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , ] , <str> : [ <str> , <str> , <str> , <str> , <str> , <str> , ] , <str> : [ <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , ] , <str> : [ <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , <str> , ] } SAVE_FIGURE = 1 outputDir = <str> def fixedintercept_exponential ( xval , intercept , tau , amp = 1 ) :      return amp * ( 1 - np . exp ( - ( xval ) / tau ) ) + intercept  def error_fixed_exponential ( theta , xval , yval , intercept ) :      yhat = fixedintercept_exponential ( xval , intercept , * theta ) return np . sum ( ( yval - yhat ) ** 2 )  figFilename = <str> figFormat = <str> figSize = [ 7 , 7 ] paradigm = <str> plt . clf ( ) plt . gcf ( ) . set_facecolor ( <str> ) fontSizeLabels = figparams . fontSizeLabels fontSizeTicks = figparams . fontSizeTicks fontSizePanel = figparams . fontSizePanel labelPosX = [ 0.02 , 0.5 ] labelPosY = [ 0.95 , 0.5 ] for inds , subject in enumerate ( sessionsDict . iterkeys ( ) ) :      eachBehavData = [ ] nTrialsToAnalyze = 140 allCorrectMidFreqAfterSwitch = np . ma . masked_array ( np . zeros ( ( 0 , nTrialsToAnalyze ) ) , dtype = int ) for session in sessionsDict [ subject ] :          behavFileName = loadbehavior . path_to_behavior_data ( subject , paradigm , session ) bdata = loadbehavior . FlexCategBehaviorData ( behavFileName ) bdata . find_trials_each_block ( ) eachBehavData . append ( bdata ) valid = bdata [ <str> ] indexValidEachBlock = [ ] for blockInd in range ( bdata . blocks [ <str> ] ) :              trialsThisBlock = bdata . blocks [ <str> ] [ : , blockInd ] indexValidEachBlock . extend ( np . cumsum ( valid [ trialsThisBlock ] ) )  bdata [ <str> ] = np . array ( indexValidEachBlock ) valid = bdata [ <str> ] . astype ( bool ) correct = bdata [ <str> ] == bdata . labels [ <str> ] [ <str> ] correctSubset = correct [ valid ] indexEachBlockSubset = bdata [ <str> ] [ valid ] trialsMidFreq = bdata [ <str> ] == bdata [ <str> ] trialsMidFreqSubset = trialsMidFreq [ valid ] trialsPerBlock = bdata [ <str> ] nSwitches = bdata . blocks [ <str> ] - 1 correctMidFreqAfterSwitch = np . ma . masked_array ( np . zeros ( ( nSwitches , nTrialsToAnalyze ) ) , dtype = int ) correctMidFreqAfterSwitch . mask = np . ones ( correctMidFreqAfterSwitch . shape , dtype = bool ) for indt in range ( nTrialsToAnalyze ) :              trialsToAnalyze = np . flatnonzero ( indexEachBlockSubset == indt + 1 ) [ 1 : ] midFreqAfterSwitch = trialsMidFreqSubset [ trialsToAnalyze ] if len ( correctSubset [ trialsToAnalyze ] ) == nSwitches :                  correctMidFreqAfterSwitch [ : , indt ] = correctSubset [ trialsToAnalyze ] correctMidFreqAfterSwitch . mask [ : , indt ] = ~ midFreqAfterSwitch  else :                  correctMidFreqAfterSwitch [ : - 1 , indt ] = correctSubset [ trialsToAnalyze ] correctMidFreqAfterSwitch . mask [ : - 1 , indt ] = ~ midFreqAfterSwitch   allCorrectMidFreqAfterSwitch = np . ma . vstack ( ( allCorrectMidFreqAfterSwitch , correctMidFreqAfterSwitch ) )  avgCorrectAfterSwitch = allCorrectMidFreqAfterSwitch . mean ( axis = 0 ) if np . any ( avgCorrectAfterSwitch . mask ) :          raise Warning ( <str> )  xval = np . arange ( len ( avgCorrectAfterSwitch ) , dtype = float ) yMeasured = avgCorrectAfterSwitch . filled ( 0.5 ) intercept = 1 - avgCorrectAfterSwitch [ - 10 : ] . mean ( ) theta0 = np . array ( [ 25. , 1 ] ) thetahat = scipy . optimize . fmin ( error_fixed_exponential , theta0 , args = ( xval , yMeasured , intercept ) , disp = False ) yFit = fixedintercept_exponential ( xval , intercept , * thetahat ) firstTrialAboveChance = np . flatnonzero ( yFit > 0.5 ) [ 0 ] print <str> . format ( subject , thetahat [ 0 ] , firstTrialAboveChance ) mfactor = 100 plt . subplot ( 2 , 2 , inds + 1 ) plt . hold ( True ) plt . plot ( xval + 1 , mfactor * avgCorrectAfterSwitch , <str> , color = <str> , mfc = <str> , mew = 2 , mec = <str> , clip_on = False ) plt . plot ( xval + 1 , mfactor * yFit , <str> , lw = 4 , color = <str> ) plt . axhline ( mfactor * 0.5 , ls = <str> , color = <str> ) plt . axvline ( firstTrialAboveChance , ls = <str> , color = <str> ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . ylabel ( <str> , ma = <str> , fontsize = fontSizeLabels , labelpad = 0.01 ) plt . ylim ( [ 0 , mfactor * 1 ] ) plt . yticks ( [ 0 , 50 , 100 ] , fontsize = fontSizeTicks ) extraplots . boxoff ( plt . gca ( ) ) plt . hold ( False ) nSess = len ( sessionsDict [ subject ] ) plt . title ( <str> . format ( inds + 1 , nSess ) , fontsize = fontSizeLabels )  plt . tight_layout ( pad = 0.2 , w_pad = 1.5 , h_pad = 1.5 , rect = ( 0.05 , 0.05 , 0.98 , 0.95 ) ) plt . show ( ) plt . annotate ( <str> , xy = ( labelPosX [ 0 ] , labelPosY [ 0 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) plt . annotate ( <str> , xy = ( labelPosX [ 1 ] , labelPosY [ 0 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) plt . annotate ( <str> , xy = ( labelPosX [ 0 ] , labelPosY [ 1 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) plt . annotate ( <str> , xy = ( labelPosX [ 1 ] , labelPosY [ 1 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) if SAVE_FIGURE :      extraplots . save_figure ( figFilename , figFormat , figSize , outputDir )   