import os import numpy as np from scipy import stats import matplotlib . pyplot as plt import matplotlib . gridspec as gridspec import matplotlib . patches as patches import matplotlib . colors from jaratoolbox import settings from jaratoolbox import extraplots import figparams import studyparams FIGNAME = <str> dataDir = os . path . join ( settings . FIGURES_DATA_PATH , figparams . STUDY_NAME , FIGNAME ) PANELS = [ 1 , 1 , 1 ] SAVE_FIGURE = 1 outputDir = <str> figFilename = <str> figFormat = <str> figSize = [ 8 , 6 ] fontSizeLabels = figparams . fontSizeLabels fontSizeTicks = figparams . fontSizeTicks fontSizePanel = figparams . fontSizePanel ExColor = figparams . colp [ <str> ] PVColor = figparams . colp [ <str> ] SOMColor = figparams . colp [ <str> ] soundColor = figparams . colp [ <str> ] labelPosX = [ 0.02 , 0.47 ] labelPosY = [ 0.96 , 0.41 ] ExampleFileName = <str> statsFileName = <str> fig = plt . gcf ( ) fig . clf ( ) fig . set_facecolor ( <str> ) gs = gridspec . GridSpec ( 2 , 2 , height_ratios = [ 1 , 0.8 ] , width_ratios = [ 0.8 , 1 ] ) gs . update ( top = 0.96 , bottom = 0.08 , left = 0.1 , right = 0.96 , wspace = 0.3 , hspace = 0.4 ) if PANELS [ 0 ] :      ExampleFile = <str> + ExampleFileName ExampleDataFullPath = os . path . join ( dataDir , ExampleFile ) ExampleData = np . load ( ExampleDataFullPath ) panelLabel = <str> axRaster = plt . subplot ( gs [ 0 , 0 ] ) plt . cla ( ) spikeTimesFromEventOnset = ExampleData [ <str> ] indexLimitsEachTrial = ExampleData [ <str> ] rasterTimeRange = ExampleData [ <str> ] trialsEachCond = ExampleData [ <str> ] possibleFreqs = ExampleData [ <str> ] labels = [ <str> % f for f in possibleFreqs / 1000 ] pRaster , hcond , zline = extraplots . raster_plot ( spikeTimesFromEventOnset , indexLimitsEachTrial , rasterTimeRange , trialsEachCond = trialsEachCond , labels = labels ) axRaster . annotate ( panelLabel , xy = ( labelPosX [ 0 ] , labelPosY [ 0 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) plt . setp ( pRaster , ms = 3 , color = <str> ) plt . locator_params ( axis = <str> , nbins = 5 ) extraplots . boxoff ( axRaster ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) extraplots . set_ticks_fontsize ( plt . gca ( ) , fontSizeTicks ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) yLims = np . array ( plt . ylim ( ) ) rect = patches . Rectangle ( ( 0 , yLims [ 1 ] * 1.02 ) , 0.1 , yLims [ 1 ] * 0.03 , linewidth = 1 , edgecolor = soundColor , facecolor = soundColor , clip_on = False ) axRaster . add_patch ( rect )  if PANELS [ 1 ] :      ExampleFile = <str> + ExampleFileName ExampleDataFullPath = os . path . join ( dataDir , ExampleFile ) ExampleData = np . load ( ExampleDataFullPath ) responseArray = ExampleData [ <str> ] SEM = ExampleData [ <str> ] possibleFreqs = ExampleData [ <str> ] baselineSpikeRate = ExampleData [ <str> ] fitFreqs = ExampleData [ <str> ] fitResponse = ExampleData [ <str> ] prefFreq = ExampleData [ <str> ] cellColour = figparams . colp [ <str> ] fitColour = figparams . colp [ <str> ] panelLabel = <str> plt . hold ( True ) axCurve = plt . subplot ( gs [ 0 , 1 ] ) l1 , = plt . plot ( np . log2 ( possibleFreqs ) , responseArray , <str> , ms = 5 , color = cellColour , mec = cellColour , clip_on = False , zorder = 4 ) plt . errorbar ( np . log2 ( possibleFreqs ) , responseArray , yerr = [ SEM , SEM ] , fmt = <str> , ecolor = cellColour , zorder = 3 ) l3 , = plt . plot ( [ fitFreqs [ 0 ] , fitFreqs [ - 1 ] ] , np . tile ( baselineSpikeRate , 2 ) , <str> , color = <str> , lw = 1.5 , zorder = 1 ) l2 , = plt . plot ( fitFreqs , fitResponse , <str> , lw = 1.5 , color = fitColour , zorder = 2 ) axCurve . annotate ( panelLabel , xy = ( labelPosX [ 1 ] , labelPosY [ 0 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) labels = [ <str> % f for f in possibleFreqs / 1000 ] labels [ 1 : : 3 ] = [ <str> ] * len ( labels [ 1 : : 3 ] ) labels [ 2 : : 3 ] = [ <str> ] * len ( labels [ 2 : : 3 ] ) axCurve . set_xticks ( np . log2 ( possibleFreqs ) ) axCurve . set_xticklabels ( labels ) axCurve . set_ylim ( bottom = 0 ) extraplots . boxoff ( axCurve ) extraplots . set_ticks_fontsize ( plt . gca ( ) , fontSizeTicks ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . xlim ( fitFreqs [ 0 ] - 0.2 , fitFreqs [ - 1 ] + 0.1 ) yLims = np . array ( plt . ylim ( ) ) xValsPointer = [ np . log2 ( prefFreq ) - 0.5 , np . log2 ( prefFreq ) - 0.5 , np . log2 ( prefFreq ) + 0.5 , np . log2 ( prefFreq ) + 0.5 ] yValsPointer = [ yLims [ 1 ] * 0.92 , yLims [ 1 ] * 0.96 , yLims [ 1 ] * 0.96 , yLims [ 1 ] * 0.92 ] axCurve . plot ( xValsPointer , yValsPointer , color = <str> ) axCurve . annotate ( <str> , xy = ( np . log2 ( prefFreq ) - 0.5 , yLims [ 1 ] * 0.98 ) , xycoords = <str> , fontsize = fontSizeLabels )  if PANELS [ 2 ] :      dataFullPath = os . path . join ( dataDir , statsFileName ) data = np . load ( dataFullPath ) axScatter = gs [ 1 , : ] panelLabel = <str> ExbestFreq = np . log2 ( data [ <str> ] ) PVbestFreq = np . log2 ( data [ <str> ] ) SOMbestFreq = np . log2 ( data [ <str> ] ) ExSI = data [ <str> ] PVSI = data [ <str> ] SOMSI = data [ <str> ] logFreqs = np . log2 ( possibleFreqs ) cellTypeLabels = [ <str> , <str> , <str> ] cellFreqs = [ ExbestFreq , PVbestFreq , SOMbestFreq ] cellSIs = [ ExSI , PVSI , SOMSI ] cellTypeColours = [ ExColor , PVColor , SOMColor ] inner = gridspec . GridSpecFromSubplotSpec ( 1 , len ( cellFreqs ) , subplot_spec = axScatter , wspace = 0.1 , hspace = 0.3 ) for cellType in range ( len ( cellFreqs ) ) :          thisAx = plt . subplot ( inner [ cellType ] ) plt . plot ( cellFreqs [ cellType ] , cellSIs [ cellType ] , <str> , mfc = cellTypeColours [ cellType ] , mec = cellTypeColours [ cellType ] , ms = 4 , zorder = cellType ) slope , intercept , rVal , pVal , stdErr = stats . linregress ( cellFreqs [ cellType ] , cellSIs [ cellType ] ) xvals = np . linspace ( 10 , 16 , 200 ) yvals = slope * xvals + intercept plt . plot ( xvals , yvals , <str> , color = cellTypeColours [ cellType ] , zorder = - 1 ) print <str> print <str> . format ( cellTypeLabels [ cellType ] , rVal , pVal ) labels = [ <str> % f for f in possibleFreqs / 1000 ] labels [ 1 : : 3 ] = [ <str> ] * len ( labels [ 1 : : 3 ] ) labels [ 2 : : 3 ] = [ <str> ] * len ( labels [ 2 : : 3 ] ) thisAx . set_xticks ( np . log2 ( possibleFreqs ) ) thisAx . set_xticklabels ( labels ) plt . xlim ( 11.5 , 15.5 ) plt . ylim ( - 0.1 , 1.1 ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . title ( <str> . format ( cellTypeLabels [ cellType ] ) ) if cellType == 0 :              plt . ylabel ( <str> , fontsize = fontSizeLabels )  else :              thisAx . set_yticklabels ( [ <str> ] )  extraplots . boxoff ( thisAx )  thisAx . annotate ( panelLabel , xy = ( labelPosX [ 0 ] , labelPosY [ 1 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> )  if SAVE_FIGURE :      extraplots . save_figure ( figFilename , figFormat , figSize , outputDir )    