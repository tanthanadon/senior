import os import numpy as np from collections import Counter import matplotlib . pyplot as plt import matplotlib . gridspec as gridspec from jaratoolbox import settings from jaratoolbox import extraplots reload ( extraplots ) from jaratoolbox import colorpalette from scipy import stats import copy import pandas as pd import figparams reload ( figparams ) np . random . seed ( 0 ) FIGNAME = <str> SAVE_FIGURE = 0 outputDir = figparams . FIGURE_OUTPUT_DIR figFilename = <str> figFormat = <str> figSize = [ 12 , 8 ] colorTagged = colorpalette . TangoPalette [ <str> ] colorDeepUntagged = colorpalette . TangoPalette [ <str> ] colorShallowUntagged = colorpalette . TangoPalette [ <str> ] labelPosX = [ 0.04 , 0.48 ] labelPosY = [ 0.48 , 0.95 ] dbPath = os . path . join ( settings . FIGURES_DATA_PATH , figparams . STUDY_NAME , <str> ) dbase = pd . read_hdf ( dbPath , key = <str> ) fig = plt . gcf ( ) plt . clf ( ) fig . set_facecolor ( <str> ) def jitter ( arr , frac ) :      jitter = ( np . random . random ( len ( arr ) ) - 0.5 ) * 2 * frac jitteredArr = arr + jitter return jitteredArr  def medline ( ax , yval , midline , width , color = <str> , linewidth = 3 ) :      start = midline - ( width / 2 ) end = midline + ( width / 2 ) ax . plot ( [ start , end ] , [ yval , yval ] , color = color , lw = linewidth )  features = [ <str> , <str> ] yLabels = [ <str> , <str> , <str> ] dataframe = dbase . query ( <str> ) goodISI = dataframe . query ( <str> ) goodShape = goodISI . query ( <str> ) goodFit = goodShape . query ( <str> ) goodFit [ <str> ] = np . sqrt ( goodFit [ <str> ] * goodFit [ <str> ] ) goodFitToUse = goodFit . query ( <str> ) depthCutoff = 1000 taggedCellsFreq = goodFitToUse [ goodFitToUse [ <str> ] == 1 ] deepUntaggedCellsFreq = goodFitToUse [ ( ( goodFitToUse [ <str> ] == 0 ) & ( goodFitToUse [ <str> ] > depthCutoff ) ) ] shallowUntaggedCellsFreq = goodFitToUse [ ( ( goodFitToUse [ <str> ] == 0 ) & ( goodFitToUse [ <str> ] < depthCutoff ) ) ] taggedCellsAM = goodShape [ goodShape [ <str> ] == 1 ] deepUntaggedCellsAM = goodShape [ ( ( goodShape [ <str> ] == 0 ) & ( goodShape [ <str> ] > depthCutoff ) ) ] shallowUntaggedCellsAM = goodShape [ ( ( goodShape [ <str> ] == 0 ) & ( goodShape [ <str> ] < depthCutoff ) ) ] gs = gridspec . GridSpec ( 2 , 21 ) gs . update ( left = 0.12 , right = 0.98 , top = 0.88 , bottom = 0.15 , wspace = 40 , hspace = 0.7 ) axBW10 = plt . subplot ( gs [ 0 , 0 : 7 ] ) axThresh = plt . subplot ( gs [ 0 , 7 : 14 ] ) axLatency = plt . subplot ( gs [ 0 , 14 : 21 ] ) gsNSYNC = gridspec . GridSpecFromSubplotSpec ( 3 , 1 , subplot_spec = gs [ 1 , 0 : 3 ] ) axTaggedNSYNC = plt . subplot ( gsNSYNC [ 0 , 0 ] ) axDeepUntaggedNSYNC = plt . subplot ( gsNSYNC [ 1 , 0 ] ) axShallowUntaggedNSYNC = plt . subplot ( gsNSYNC [ 2 , 0 ] ) axHighestSync = plt . subplot ( gs [ 1 , 3 : 9 ] ) axMIRate = plt . subplot ( gs [ 1 , 9 : 15 ] ) axMIPhase = plt . subplot ( gs [ 1 , 15 : 21 ] ) feature = <str> dataTagged = taggedCellsFreq [ feature ] [ pd . notnull ( taggedCellsFreq [ feature ] ) ] dataDeepUntagged = deepUntaggedCellsFreq [ feature ] [ pd . notnull ( deepUntaggedCellsFreq [ feature ] ) ] dataShallowUntagged = shallowUntaggedCellsFreq [ feature ] [ pd . notnull ( shallowUntaggedCellsFreq [ feature ] ) ] ax = axBW10 ax . set_ylabel ( <str> ) posTagged = jitter ( np . ones ( len ( dataTagged ) ) * 0 , 0.20 ) posDeepUntagged = jitter ( np . ones ( len ( dataDeepUntagged ) ) * 1 , 0.20 ) posShallowUntagged = jitter ( np . ones ( len ( dataShallowUntagged ) ) * 2 , 0.20 ) boxData = [ dataTagged , dataDeepUntagged , dataShallowUntagged ] bp = axBW10 . boxplot ( boxData , widths = 0.5 , showfliers = False , positions = [ 0 , 1 , 2 ] ) colors = [ colorTagged , colorDeepUntagged , colorShallowUntagged ] whiskerColors = [ colorTagged , colorTagged , colorDeepUntagged , colorDeepUntagged , colorShallowUntagged , colorShallowUntagged ] boxColor = <str> linewidth = 2 for patch , color in zip ( bp [ <str> ] , colors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  for patch , color in zip ( bp [ <str> ] , whiskerColors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  for patch , color in zip ( bp [ <str> ] , colors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  plt . setp ( bp [ <str> ] , visible = False ) ax . set_xticks ( [ 0 , 1 , 2 ] ) ax . set_xticklabels ( [ <str> . format ( len ( dataTagged ) ) , <str> . format ( len ( dataDeepUntagged ) ) , <str> . format ( len ( dataShallowUntagged ) ) ] ) extraplots . boxoff ( ax ) yMin = 0 yMax = 2 yStars = [ yMax * 1.1 , yMax * 1.2 ] yStarHeight = ( yMax - yMin ) * 0.05 starGapFactor = 0.1 fontSizeStars = 9 zVal , pVal = stats . mannwhitneyu ( dataTagged , dataDeepUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 0 , 0.9 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 0 , 0.9 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  zVal , pVal = stats . mannwhitneyu ( dataDeepUntagged , dataShallowUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 1.1 , 2 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 1.1 , 2 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor * 1.5 , ax = ax )  zVal , pVal = stats . mannwhitneyu ( dataTagged , dataShallowUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 0 , 2 ] , yStars [ 1 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 0 , 2 ] , yStars [ 1 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  ax . set_ylim ( [ yMin , yMax ] ) feature = <str> dataTagged = taggedCellsFreq [ feature ] [ pd . notnull ( taggedCellsFreq [ feature ] ) ] dataDeepUntagged = deepUntaggedCellsFreq [ feature ] [ pd . notnull ( deepUntaggedCellsFreq [ feature ] ) ] dataShallowUntagged = shallowUntaggedCellsFreq [ feature ] [ pd . notnull ( shallowUntaggedCellsFreq [ feature ] ) ] ax = axThresh boxData = [ dataTagged , dataDeepUntagged , dataShallowUntagged ] bp = axThresh . boxplot ( boxData , widths = 0.5 , showfliers = False , positions = [ 0 , 1 , 2 ] ) colors = [ colorTagged , colorDeepUntagged , colorShallowUntagged ] whiskerColors = [ colorTagged , colorTagged , colorDeepUntagged , colorDeepUntagged , colorShallowUntagged , colorShallowUntagged ] linewidth = 2 for patch , color in zip ( bp [ <str> ] , colors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  for patch , color in zip ( bp [ <str> ] , whiskerColors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  for patch , color in zip ( bp [ <str> ] , colors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  plt . setp ( bp [ <str> ] , visible = False ) ax . set_xticks ( [ 0 , 1 , 2 ] ) ax . set_xticklabels ( [ <str> . format ( len ( dataTagged ) ) , <str> . format ( len ( dataDeepUntagged ) ) , <str> . format ( len ( dataShallowUntagged ) ) ] ) extraplots . boxoff ( ax ) yMin = 0 yMax = 65 yStars = [ yMax * 1.1 , yMax * 1.2 ] yStarHeight = ( yMax - yMin ) * 0.05 starGapFactor = 0.1 fontSizeStars = 9 zVal , pVal = stats . mannwhitneyu ( dataTagged , dataDeepUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 0 , 0.9 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 0 , 0.9 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  zVal , pVal = stats . mannwhitneyu ( dataDeepUntagged , dataShallowUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 1.1 , 2 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 1.1 , 2 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor * 1.5 , ax = ax )  zVal , pVal = stats . mannwhitneyu ( dataTagged , dataShallowUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 0 , 2 ] , yStars [ 1 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 0 , 2 ] , yStars [ 1 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  ax . set_ylim ( [ yMin , yMax ] ) ax . set_ylabel ( <str> ) latencyQuery = <str> taggedCellsLatency = taggedCellsFreq . query ( latencyQuery ) deepUntaggedCellsLatency = deepUntaggedCellsFreq . query ( latencyQuery ) shallowUntaggedCellsLatency = shallowUntaggedCellsFreq . query ( latencyQuery ) feature = <str> dataTagged = taggedCellsLatency [ feature ] [ pd . notnull ( taggedCellsLatency [ feature ] ) ] dataDeepUntagged = deepUntaggedCellsLatency [ feature ] [ pd . notnull ( deepUntaggedCellsLatency [ feature ] ) ] dataShallowUntagged = shallowUntaggedCellsLatency [ feature ] [ pd . notnull ( shallowUntaggedCellsLatency [ feature ] ) ] ax = axLatency boxData = [ dataTagged , dataDeepUntagged , dataShallowUntagged ] bp = axLatency . boxplot ( boxData , widths = 0.5 , showfliers = False , positions = [ 0 , 1 , 2 ] ) colors = [ colorTagged , colorDeepUntagged , colorShallowUntagged ] whiskerColors = [ colorTagged , colorTagged , colorDeepUntagged , colorDeepUntagged , colorShallowUntagged , colorShallowUntagged ] linewidth = 2 for patch , color in zip ( bp [ <str> ] , colors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  for patch , color in zip ( bp [ <str> ] , whiskerColors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  for patch , color in zip ( bp [ <str> ] , colors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  plt . setp ( bp [ <str> ] , visible = False ) ax . set_xticks ( [ 0 , 1 , 2 ] ) ax . set_xticklabels ( [ <str> . format ( len ( dataTagged ) ) , <str> . format ( len ( dataDeepUntagged ) ) , <str> . format ( len ( dataShallowUntagged ) ) ] ) extraplots . boxoff ( ax ) yMin = 0 yMax = 0.04 yStars = [ yMax * 1.1 , yMax * 1.2 ] yStarHeight = ( yMax - yMin ) * 0.05 starGapFactor = 0.1 fontSizeStars = 9 zVal , pVal = stats . mannwhitneyu ( dataTagged , dataDeepUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 0 , 0.9 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 0 , 0.9 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  zVal , pVal = stats . mannwhitneyu ( dataDeepUntagged , dataShallowUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 1.1 , 2 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 1.1 , 2 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor * 1.5 , ax = ax )  zVal , pVal = stats . mannwhitneyu ( dataTagged , dataShallowUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 0 , 2 ] , yStars [ 1 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 0 , 2 ] , yStars [ 1 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  ax . set_ylim ( [ yMin , yMax ] ) ax . set_ylabel ( <str> ) feature = <str> dataTagged = taggedCellsAM [ feature ] [ pd . notnull ( taggedCellsAM [ feature ] ) ] dataDeepUntagged = deepUntaggedCellsAM [ feature ] [ pd . notnull ( deepUntaggedCellsAM [ feature ] ) ] dataShallowUntagged = shallowUntaggedCellsAM [ feature ] [ pd . notnull ( shallowUntaggedCellsAM [ feature ] ) ] taggedSyncN = len ( dataTagged [ dataTagged > 0 ] ) taggedNonSyncN = len ( dataTagged [ dataTagged == 0 ] ) taggedSyncFrac = taggedSyncN / float ( taggedSyncN + taggedNonSyncN ) taggedNonSyncFrac = taggedNonSyncN / float ( taggedSyncN + taggedNonSyncN ) deepUntaggedSyncN = len ( dataDeepUntagged [ dataDeepUntagged > 0 ] ) deepUntaggedNonSyncN = len ( dataDeepUntagged [ dataDeepUntagged == 0 ] ) deepUntaggedSyncFrac = deepUntaggedSyncN / float ( deepUntaggedSyncN + deepUntaggedNonSyncN ) deepUntaggedNonSyncFrac = deepUntaggedNonSyncN / float ( deepUntaggedSyncN + deepUntaggedNonSyncN ) shallowUntaggedSyncN = len ( dataShallowUntagged [ dataShallowUntagged > 0 ] ) shallowUntaggedNonSyncN = len ( dataShallowUntagged [ dataShallowUntagged == 0 ] ) shallowUntaggedSyncFrac = shallowUntaggedSyncN / float ( shallowUntaggedSyncN + shallowUntaggedNonSyncN ) shallowUntaggedNonSyncFrac = shallowUntaggedNonSyncN / float ( shallowUntaggedSyncN + shallowUntaggedNonSyncN ) pieWedges = axTaggedNSYNC . pie ( [ taggedNonSyncFrac , taggedSyncFrac ] , colors = [ colorTagged , <str> ] , shadow = False , startangle = 0 ) for wedge in pieWedges [ 0 ] :      wedge . set_edgecolor ( colorTagged )  axTaggedNSYNC . set_aspect ( <str> ) pieWedges = axDeepUntaggedNSYNC . pie ( [ deepUntaggedNonSyncFrac , deepUntaggedSyncFrac ] , colors = [ colorDeepUntagged , <str> ] , shadow = False , startangle = 0 ) for wedge in pieWedges [ 0 ] :      wedge . set_edgecolor ( colorDeepUntagged )  axDeepUntaggedNSYNC . set_aspect ( <str> ) pieWedges = axShallowUntaggedNSYNC . pie ( [ shallowUntaggedNonSyncFrac , shallowUntaggedSyncFrac ] , colors = [ colorShallowUntagged , <str> ] , shadow = False , startangle = 0 ) for wedge in pieWedges [ 0 ] :      wedge . set_edgecolor ( colorShallowUntagged )  axShallowUntaggedNSYNC . set_aspect ( <str> ) xBars = [ - 2 , - 3 ] yCircleCenters = [ 0 , 3 , 6 ] xTickWidth = 0.2 yGapWidth = 1.5 def plot_y_lines_with_ticks ( ax , x , y1 , y2 , gapwidth , tickwidth , color = <str> , starMarker = <str> , fontSize = 9 ) :      ax . plot ( [ x , x ] , [ y1 , np . mean ( [ y1 , y2 ] ) - ( gapwidth / 2 ) ] , <str> , clip_on = False , color = color ) ax . hold ( 1 ) ax . plot ( [ x , x ] , [ np . mean ( [ y1 , y2 ] ) + ( gapwidth / 2 ) , y2 ] , <str> , clip_on = False , color = color ) ax . plot ( [ x , x + xTickWidth ] , [ y1 , y1 ] , <str> , clip_on = False , color = color ) ax . plot ( [ x , x + xTickWidth ] , [ y2 , y2 ] , <str> , clip_on = False , color = color ) ax . text ( x , np . mean ( [ y1 , y2 ] ) , starMarker , fontsize = fontSize , va = <str> , ha = <str> , clip_on = False , rotation = 90 )  oddsratio , pValue = stats . fisher_exact ( [ [ shallowUntaggedSyncN , deepUntaggedSyncN ] , [ shallowUntaggedNonSyncN , deepUntaggedNonSyncN ] ] ) if pValue < 0.05 :      starMarker = <str>  else :      starMarker = <str>  plot_y_lines_with_ticks ( axShallowUntaggedNSYNC , xBars [ 0 ] , yCircleCenters [ 0 ] , yCircleCenters [ 1 ] - 0.1 , yGapWidth , xTickWidth , starMarker = starMarker ) oddsratio , pValue = stats . fisher_exact ( [ [ deepUntaggedSyncN , taggedSyncN ] , [ deepUntaggedNonSyncN , taggedNonSyncN ] ] ) if pValue < 0.05 :      starMarker = <str>  else :      starMarker = <str>  plot_y_lines_with_ticks ( axShallowUntaggedNSYNC , xBars [ 0 ] , yCircleCenters [ 1 ] + 0.1 , yCircleCenters [ 2 ] , yGapWidth , xTickWidth , starMarker = starMarker ) oddsratio , pValue = stats . fisher_exact ( [ [ shallowUntaggedSyncN , taggedSyncN ] , [ shallowUntaggedNonSyncN , taggedNonSyncN ] ] ) if pValue < 0.05 :      starMarker = <str>  else :      starMarker = <str>  plot_y_lines_with_ticks ( axShallowUntaggedNSYNC , xBars [ 1 ] , yCircleCenters [ 0 ] , yCircleCenters [ 2 ] , yGapWidth , xTickWidth , starMarker = starMarker ) ax = axHighestSync dataTagged = dataTagged [ dataTagged > 0 ] dataTagged = np . log ( dataTagged ) dataDeepUntagged = dataDeepUntagged [ dataDeepUntagged > 0 ] dataDeepUntagged = np . log ( dataDeepUntagged ) dataShallowUntagged = dataShallowUntagged [ dataShallowUntagged > 0 ] dataShallowUntagged = np . log ( dataShallowUntagged ) ytickLabels = [ 4 , 8 , 16 , 32 , 64 , 128 ] yticks = np . log ( ytickLabels ) boxData = [ dataTagged , dataDeepUntagged , dataShallowUntagged ] bp = axHighestSync . boxplot ( boxData , widths = 0.5 , showfliers = False , positions = [ 0 , 1 , 2 ] ) colors = [ colorTagged , colorDeepUntagged , colorShallowUntagged ] whiskerColors = [ colorTagged , colorTagged , colorDeepUntagged , colorDeepUntagged , colorShallowUntagged , colorShallowUntagged ] linewidth = 2 for patch , color in zip ( bp [ <str> ] , colors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  for patch , color in zip ( bp [ <str> ] , whiskerColors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  for patch , color in zip ( bp [ <str> ] , colors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  plt . setp ( bp [ <str> ] , visible = False ) ax . set_xticks ( [ 0 , 1 , 2 ] ) ax . set_xticklabels ( [ <str> . format ( len ( dataTagged ) ) , <str> . format ( len ( dataDeepUntagged ) ) , <str> . format ( len ( dataShallowUntagged ) ) ] ) ax . set_yticks ( yticks ) ax . set_yticklabels ( ytickLabels ) yMin = np . log ( 3 ) yMax = np . log ( 128 ) yStars = [ yMax * 1.1 , yMax * 1.2 ] yStarHeight = ( yMax - yMin ) * 0.05 starGapFactor = 0.1 fontSizeStars = 9 zVal , pVal = stats . mannwhitneyu ( dataTagged , dataDeepUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 0 , 0.9 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 0 , 0.9 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  zVal , pVal = stats . mannwhitneyu ( dataDeepUntagged , dataShallowUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 1.1 , 2 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 1.1 , 2 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor * 1.5 , ax = ax )  zVal , pVal = stats . mannwhitneyu ( dataTagged , dataShallowUntagged ) print <str> . format ( zVal , pVal ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 0 , 2 ] , yStars [ 1 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  else :      extraplots . new_significance_stars ( [ 0 , 2 ] , yStars [ 1 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor , ax = ax )  ax . set_ylim ( [ yMin , yMax ] ) ax . set_ylabel ( <str> ) extraplots . boxoff ( ax ) ax = axMIRate feature = <str> dataTagged = taggedCellsAM [ feature ] [ pd . notnull ( taggedCellsAM [ feature ] ) ] dataTagged [ dataTagged < 0 ] = 0 dataDeepUntagged = deepUntaggedCellsAM [ feature ] [ pd . notnull ( deepUntaggedCellsAM [ feature ] ) ] dataDeepUntagged [ dataDeepUntagged < 0 ] = 0 dataShallowUntagged = shallowUntaggedCellsAM [ feature ] [ pd . notnull ( shallowUntaggedCellsAM [ feature ] ) ] dataShallowUntagged [ dataShallowUntagged < 0 ] = 0 boxData = [ dataTagged , dataDeepUntagged , dataShallowUntagged ] bp = axMIRate . boxplot ( boxData , widths = 0.5 , showfliers = False , positions = [ 0 , 1 , 2 ] ) colors = [ colorTagged , colorDeepUntagged , colorShallowUntagged ] whiskerColors = [ colorTagged , colorTagged , colorDeepUntagged , colorDeepUntagged , colorShallowUntagged , colorShallowUntagged ] linewidth = 2 for patch , color in zip ( bp [ <str> ] , colors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  for patch , color in zip ( bp [ <str> ] , whiskerColors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  for patch , color in zip ( bp [ <str> ] , colors ) :      patch . set_color ( color ) patch . set_lw ( linewidth )  plt . setp ( bp [ <str> ] , visible = False ) ax . set_xticks ( [ 0 , 1 , 2 ] ) ax . set_xticklabels ( [ <str> . format ( len ( dataTagged ) ) , <str> . format ( len ( dataDeepUntagged ) ) , <str> . format ( len ( dataShallowUntagged ) ) ] ) yMin = 0 yMax = 0.3 yStars = [ yMax * 1.1 , yMax * 1.2 ] yStarHeight = ( yMax - yMin ) * 0.05 starGapFactor = [ 0.1 , 0.2 ] fontSizeStars = 9 zVal , pVal = stats . mannwhitneyu ( dataTagged , dataDeepUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 0 , 0.9 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor [ 1 ] , ax = ax )  else :      extraplots . new_significance_stars ( [ 0 , 0.9 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor [ 1 ] , ax = ax )  zVal , pVal = stats . mannwhitneyu ( dataDeepUntagged , dataShallowUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 1.1 , 2 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor [ 1 ] , ax = ax )  else :      extraplots . new_significance_stars ( [ 1.1 , 2 ] , yStars [ 0 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor [ 1 ] , ax = ax )  zVal , pVal = stats . mannwhitneyu ( dataTagged , dataShallowUntagged ) if pVal < 0.05 :      extraplots . new_significance_stars ( [ 0 , 2 ] , yStars [ 1 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor [ 0 ] , ax = ax )  else :      extraplots . new_significance_stars ( [ 0 , 2 ] , yStars [ 1 ] , yStarHeight , starMarker = <str> , fontSize = fontSizeStars , gapFactor = starGapFactor [ 0 ] , ax = ax )  ax . set_ylabel ( <str> ) ax . set_ylim ( [ yMin , yMax ] ) extraplots . boxoff ( ax ) ax = axMIPhase possibleFreqKeys = [ 4 , 5 , 8 , 11 , 16 , 22 , 32 , 45 , 64 , 90 , 128 ] keys = [ <str> . format ( rate ) for rate in possibleFreqKeys ] dataTagged = np . full ( ( len ( taggedCellsAM ) , len ( possibleFreqKeys ) ) , np . nan ) dataDeepUntagged = np . full ( ( len ( deepUntaggedCellsAM ) , len ( possibleFreqKeys ) ) , np . nan ) dataShallowUntagged = np . full ( ( len ( shallowUntaggedCellsAM ) , len ( possibleFreqKeys ) ) , np . nan ) for externalInd , ( indRow , row ) in enumerate ( taggedCellsAM . iterrows ( ) ) :      for indKey , key in enumerate ( keys ) :          dataTagged [ externalInd , indKey ] = row [ key ]   for externalInd , ( indRow , row ) in enumerate ( deepUntaggedCellsAM . iterrows ( ) ) :      for indKey , key in enumerate ( keys ) :          dataDeepUntagged [ externalInd , indKey ] = row [ key ]   for externalInd , ( indRow , row ) in enumerate ( shallowUntaggedCellsAM . iterrows ( ) ) :      for indKey , key in enumerate ( keys ) :          dataShallowUntagged [ externalInd , indKey ] = row [ key ]   dataTagged [ dataTagged < 0 ] = 0 dataDeepUntagged [ dataDeepUntagged < 0 ] = 0 dataShallowUntagged [ dataShallowUntagged < 0 ] = 0 allPval = [ ] for indCol , freqKey in enumerate ( possibleFreqKeys ) :      dataTaggedThisFreq = dataTagged [ : , indCol ] [ np . logical_not ( np . isnan ( dataTagged [ : , indCol ] ) ) ] dataDeepUntaggedThisFreq = dataDeepUntagged [ : , indCol ] [ np . logical_not ( np . isnan ( dataDeepUntagged [ : , indCol ] ) ) ] dataShallowUntaggedThisFreq = dataShallowUntagged [ : , indCol ] [ np . logical_not ( np . isnan ( dataShallowUntagged [ : , indCol ] ) ) ]  taggedMean = np . nanmean ( dataTagged , axis = 0 ) taggedStd = np . nanstd ( dataTagged , axis = 0 ) deepUntaggedMean = np . nanmean ( dataDeepUntagged , axis = 0 ) deepUntaggedStd = np . nanstd ( dataDeepUntagged , axis = 0 ) shallowUntaggedMean = np . nanmean ( dataShallowUntagged , axis = 0 ) shallowUntaggedStd = np . nanstd ( dataShallowUntagged , axis = 0 ) numTagged = sum ( np . logical_not ( np . isnan ( dataTagged [ : , 0 ] ) ) ) numDeepUntagged = sum ( np . logical_not ( np . isnan ( dataDeepUntagged [ : , 0 ] ) ) ) numShallowUntagged = sum ( np . logical_not ( np . isnan ( dataShallowUntagged [ : , 0 ] ) ) ) ax . plot ( taggedMean , <str> , color = colorTagged , label = <str> . format ( numTagged ) ) plt . hold ( 1 ) ax . plot ( deepUntaggedMean , <str> , color = colorDeepUntagged , label = <str> . format ( numDeepUntagged ) ) ax . plot ( shallowUntaggedMean , <str> , color = colorShallowUntagged , label = <str> . format ( numShallowUntagged ) ) ax . set_xticks ( range ( len ( possibleFreqKeys ) ) [ : : 2 ] ) ax . set_xticklabels ( possibleFreqKeys [ : : 2 ] ) ax . set_xlabel ( <str> ) extraplots . boxoff ( ax ) plt . show ( )  