import os import numpy as np import matplotlib . pyplot as plt import matplotlib . gridspec as gridspec import matplotlib . colors import matplotlib . patches as patches from scipy import stats from jaratoolbox import settings from jaratoolbox import extraplots import figparams FIGNAME = <str> dataDir = os . path . join ( settings . FIGURES_DATA_PATH , figparams . STUDY_NAME , FIGNAME ) PANELS = [ 1 , 0 , 1 ] SAVE_FIGURE = 1 outputDir = <str> figFilename = <str> figFormat = <str> figSize = [ 8 , 6 ] fontSizeLabels = figparams . fontSizeLabels fontSizeTicks = figparams . fontSizeTicks fontSizePanel = figparams . fontSizePanel fontSizeLegend = figparams . fontSizeLegend labelPosX = [ 0.02 , 0.36 , 0.55 ] labelPosY = [ 0.96 , 0.46 ] PVFileName = <str> SOMFileName = <str> summaryFileName = <str> ExcColour = figparams . colp [ <str> ] PVColour = figparams . colp [ <str> ] SOMColour = figparams . colp [ <str> ] laserColour = figparams . colp [ <str> ] soundColour = figparams . colp [ <str> ] fig = plt . gcf ( ) fig . clf ( ) fig . set_facecolor ( <str> ) gs = gridspec . GridSpec ( 2 , 2 ) gs . update ( top = 0.95 , bottom = 0.1 , left = 0.1 , right = 0.99 , wspace = 0.2 , hspace = 0.4 ) if PANELS [ 0 ] :      exampleCells = [ PVFileName , SOMFileName ] cellColours = [ PVColour , SOMColour ] panelLabels = [ <str> , <str> ] PSTHylims = [ ( - 1 , 47 ) , ( - 0.4 , 16 ) ] for indCell , cell in enumerate ( exampleCells ) :          axExample = gs [ indCell , 0 ] exampleDataFullPath = os . path . join ( dataDir , cell ) exampleData = np . load ( exampleDataFullPath ) laserTrials = exampleData [ <str> ] inner = gridspec . GridSpecFromSubplotSpec ( 3 , 1 , subplot_spec = axExample , wspace = 0.1 , hspace = 0.4 ) for laser in laserTrials :              axRaster = plt . subplot ( inner [ laser , 0 ] ) trialsEachCond = exampleData [ <str> ] [ : , laser ] trialsEachCond = np . reshape ( trialsEachCond , ( len ( trialsEachCond ) , 1 ) ) pRaster , hcond , zline = extraplots . raster_plot ( exampleData [ <str> ] , exampleData [ <str> ] , exampleData [ <str> ] , trialsEachCond = trialsEachCond ) plt . setp ( pRaster , ms = 3 ) plt . locator_params ( axis = <str> , nbins = 4 ) axRaster . set_xticklabels ( <str> ) while len ( hcond ) > 0 :                  bar = hcond . pop ( 0 ) bar . remove ( )  yLims = np . array ( plt . ylim ( ) ) rect = patches . Rectangle ( ( 0.0 , yLims [ 1 ] * 1.06 ) , 1.0 , yLims [ 1 ] * 0.05 , linewidth = 1 , edgecolor = soundColour , facecolor = soundColour , clip_on = False ) axRaster . add_patch ( rect ) if laser :                  yLims = np . array ( plt . ylim ( ) ) rect = patches . Rectangle ( ( - 0.1 , yLims [ 1 ] * 1.16 ) , 1.3 , yLims [ 1 ] * 0.05 , linewidth = 1 , edgecolor = laserColour , facecolor = laserColour , clip_on = False ) axRaster . add_patch ( rect )   axPSTH = plt . subplot ( inner [ 2 , 0 ] ) binStartTimes = exampleData [ <str> ] controlPSTH = exampleData [ <str> ] laserPSTH = exampleData [ <str> ] smoothWinSize = 2 winShape = np . concatenate ( ( np . zeros ( smoothWinSize ) , np . ones ( smoothWinSize ) ) ) winShape = winShape / np . sum ( winShape ) controlPSTHSmooth = np . convolve ( controlPSTH , winShape , mode = <str> ) laserPSTHSmooth = np . convolve ( laserPSTH , winShape , mode = <str> ) controlPSTHSmooth [ : smoothWinSize ] = controlPSTH [ : smoothWinSize ] laserPSTHSmooth [ : smoothWinSize ] = laserPSTH [ : smoothWinSize ] plt . hold ( 1 ) l1 , = plt . plot ( binStartTimes , controlPSTHSmooth , color = ExcColour , lw = 2 ) l2 , = plt . plot ( binStartTimes , laserPSTHSmooth , color = cellColours [ indCell ] , lw = 2 ) plt . legend ( [ l1 , l2 ] , [ <str> , <str> ] , bbox_to_anchor = ( 1.0 , 1.35 ) , frameon = False , fontsize = fontSizeLegend , ncol = 2 ) zline = plt . axvline ( 0 , color = <str> , zorder = - 10 ) plt . ylim ( PSTHylims [ indCell ] ) plt . locator_params ( axis = <str> , nbins = 4 ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) extraplots . boxoff ( axPSTH ) plt . gcf ( ) . add_subplot ( inner [ : - 1 , 0 ] , frameon = False ) plt . tick_params ( labelcolor = <str> , top = False , bottom = False , left = False , right = False ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) axRaster . annotate ( panelLabels [ indCell ] , xy = ( labelPosX [ 0 ] , labelPosY [ indCell ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> )   if PANELS [ 1 ] :      summaryDataFullPath = os . path . join ( dataDir , summaryFileName ) summaryData = np . load ( summaryDataFullPath ) cellColours = [ PVColour , SOMColour ] panelLabels = [ <str> , <str> ] PVcontrolResponses = summaryData [ <str> ] PVlaserResponses = summaryData [ <str> ] SOMcontrolResponses = summaryData [ <str> ] SOMlaserResponses = summaryData [ <str> ] PVpVals = summaryData [ <str> ] SOMpVals = summaryData [ <str> ] PVcontrolLaserOnsets = summaryData [ <str> ] PVlaserOnsets = summaryData [ <str> ] PVchangeLaserOnsetResponse = PVlaserOnsets - PVcontrolLaserOnsets SOMcontrolLaserOnsets = summaryData [ <str> ] SOMlaserOnsets = summaryData [ <str> ] SOMchangeLaserOnsetResponse = SOMlaserOnsets - SOMcontrolLaserOnsets PVlaserOnsetpVals = summaryData [ <str> ] SOMlaserOnsetpVals = summaryData [ <str> ] responses = [ [ PVcontrolResponses , PVlaserResponses ] , [ SOMcontrolResponses , SOMlaserResponses ] ] pVals = [ PVpVals , SOMpVals ] onsetChange = [ PVchangeLaserOnsetResponse , SOMchangeLaserOnsetResponse ] laserpVals = [ PVlaserOnsetpVals , SOMlaserOnsetpVals ] for indType , cellType in enumerate ( responses ) :          axScatter = plt . subplot ( gs [ indType , 2 ] ) plt . hold ( True ) sigCells = ( pVals [ indType ] < 0.05 ) & ( cellType [ 0 ] > cellType [ 1 ] ) sigOnsetCells = ( laserpVals [ indType ] < 0.05 ) & ( onsetChange [ indType ] < 0 ) axisMin = 0.03 cellType [ 0 ] [ cellType [ 0 ] < axisMin ] = axisMin cellType [ 1 ] [ cellType [ 1 ] < axisMin ] = axisMin plt . scatter ( cellType [ 0 ] [ sigCells ] , cellType [ 1 ] [ sigCells ] , edgecolors = cellColours [ indType ] , facecolors = <str> , s = 15 ) plt . scatter ( cellType [ 0 ] [ sigOnsetCells ] , cellType [ 1 ] [ sigOnsetCells ] , marker = <str> , color = <str> , s = 15 , zorder = 10 ) plt . scatter ( cellType [ 0 ] [ ~ sigCells ] , cellType [ 1 ] [ ~ sigCells ] , edgecolors = cellColours [ indType ] , facecolors = cellColours [ indType ] , s = 15 ) plt . ylabel ( <str> , fontsize = fontSizeLabels ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) axScatter . set_xscale ( <str> , basex = 10 ) axScatter . set_yscale ( <str> , basex = 10 ) plt . plot ( [ - 5 , 100 ] , [ - 5 , 100 ] , <str> ) plt . xlim ( axisMin , 100 ) plt . ylim ( axisMin , 100 ) axScatter . tick_params ( top = False , right = False , which = <str> ) ticks = [ 0.1 , 1 , 10 , 100 ] axScatter . set_xticks ( ticks ) axScatter . set_xticklabels ( ticks ) axScatter . set_yticks ( ticks ) axScatter . set_yticklabels ( ticks ) axScatter . annotate ( panelLabels [ indType ] , xy = ( labelPosX [ 1 ] , labelPosY [ indType ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) extraplots . boxoff ( axScatter ) axScatter . set ( adjustable = <str> , aspect = <str> )   if PANELS [ 2 ] :      summaryDataFullPath = os . path . join ( dataDir , summaryFileName ) summaryData = np . load ( summaryDataFullPath ) cellColours = [ PVColour , SOMColour ] panelLabels = [ <str> , <str> ] PVcontrolResponses = summaryData [ <str> ] PVlaserResponses = summaryData [ <str> ] PVchangeSoundResponse = PVlaserResponses - PVcontrolResponses SOMcontrolResponses = summaryData [ <str> ] SOMlaserResponses = summaryData [ <str> ] SOMchangeSoundResponse = SOMlaserResponses - SOMcontrolResponses PVcontrolLaserOnsets = summaryData [ <str> ] PVlaserOnsets = summaryData [ <str> ] PVchangeLaserOnsetResponse = PVlaserOnsets - PVcontrolLaserOnsets SOMcontrolLaserOnsets = summaryData [ <str> ] SOMlaserOnsets = summaryData [ <str> ] SOMchangeLaserOnsetResponse = SOMlaserOnsets - SOMcontrolLaserOnsets PVpVals = summaryData [ <str> ] SOMpVals = summaryData [ <str> ] PVlaserOnsetpVals = summaryData [ <str> ] SOMlaserOnsetpVals = summaryData [ <str> ] responses = [ [ PVchangeLaserOnsetResponse , PVchangeSoundResponse ] , [ SOMchangeLaserOnsetResponse , SOMchangeSoundResponse ] ] pVals = [ PVlaserOnsetpVals , SOMlaserOnsetpVals ] xRanges = [ [ - 30 , 40 ] , [ - 20 , 30 ] ] yRanges = [ [ - 40 , 30 ] , [ - 20 , 30 ] ] for indType , cellType in enumerate ( responses ) :          axScatter = plt . subplot ( gs [ indType , 1 ] ) plt . hold ( True ) sigCells = ( pVals [ indType ] < 0.05 ) & ( cellType [ 0 ] < 0 ) print np . sum ( sigCells ) plt . scatter ( cellType [ 0 ] [ sigCells ] , cellType [ 1 ] [ sigCells ] , edgecolors = cellColours [ indType ] , facecolors = <str> , s = 15 ) plt . scatter ( cellType [ 0 ] [ ~ sigCells ] , cellType [ 1 ] [ ~ sigCells ] , edgecolors = cellColours [ indType ] , facecolors = cellColours [ indType ] , s = 15 ) plt . ylabel ( <str> <str> , fontsize = fontSizeLabels ) plt . xlabel ( <str> , fontsize = fontSizeLabels ) plt . plot ( [ 0 , 0 ] , yRanges [ indType ] , <str> ) plt . plot ( xRanges [ indType ] , [ 0 , 0 ] , <str> ) plt . xlim ( xRanges [ indType ] ) plt . ylim ( yRanges [ indType ] ) axScatter . annotate ( panelLabels [ indType ] , xy = ( labelPosX [ 2 ] , labelPosY [ indType ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) extraplots . boxoff ( axScatter ) axScatter . set ( adjustable = <str> , aspect = <str> )   if SAVE_FIGURE :      extraplots . save_figure ( figFilename , figFormat , figSize , outputDir )    