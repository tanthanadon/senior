import os import numpy as np import matplotlib . pyplot as plt import matplotlib . gridspec as gridspec from jaratoolbox import settings from jaratoolbox import extraplots from scipy import stats import figparams reload ( figparams ) np . random . seed ( 1001 ) FIGNAME = <str> dataDir = os . path . join ( settings . FIGURES_DATA_PATH , figparams . STUDY_NAME , FIGNAME ) anat036nonLem = np . load ( os . path . join ( dataDir , <str> ) ) anat036ventral = np . load ( os . path . join ( dataDir , <str> ) ) anat037nonLem = np . load ( os . path . join ( dataDir , <str> ) ) anat037ventral = np . load ( os . path . join ( dataDir , <str> ) ) anat043nonLem = np . load ( os . path . join ( dataDir , <str> ) ) anat043ventral = np . load ( os . path . join ( dataDir , <str> ) ) cortexCellDepths = np . load ( os . path . join ( dataDir , <str> ) ) def jitter ( arr , frac ) :      jitter = ( np . random . random ( len ( arr ) ) - 0.5 ) * 2 * frac jitteredArr = arr + jitter return jitteredArr  def medline ( yval , midline , width , color = <str> , linewidth = 3 ) :      start = midline - ( width / 2 ) end = midline + ( width / 2 ) plt . plot ( [ start , end ] , [ yval , yval ] , color = color , lw = linewidth )  PANELS = [ 1 , 1 , 1 , 1 , 1 , 1 ] SAVE_FIGURE = 1 figFilename = <str> figFormat = <str> figSize = [ 6.5 , 11 ] outputDir = <str> fontSizeLabels = 18 fontSizeTicks = figparams . fontSizeTicks * 3 fontSizePanel = figparams . fontSizePanel * 2 dataMS = 8 fontSizeNS = figparams . fontSizeNS fontSizeStars = figparams . fontSizeStars starHeightFactor = figparams . starHeightFactor starGapFactor = figparams . starGapFactor starYfactor = figparams . starYfactor * 2 dotEdgeColor = figparams . dotEdgeColor barColor = <str> anat036NonLemColor = <str> anat037NonLemColor = <str> anat043NonLemColor = <str> anat036VentralColor = <str> anat037VentralColor = <str> anat043VentralColor = <str> labelPosX = [ 0.03 , 0.53 ] labelPosY = [ 0.97 , 0.62 , 0.32 ] fig = plt . gcf ( ) fig . clf ( ) fig . set_facecolor ( <str> ) gs = gridspec . GridSpec ( 3 , 3 ) gs . update ( left = 0.15 , right = 0.92 , top = 0.90 , bottom = 0.08 , wspace = .1 , hspace = 0.5 ) axInjectionCartoon = plt . subplot ( gs [ 0 , : ] ) axInjectionCartoon . annotate ( <str> , xy = ( labelPosX [ 0 ] , labelPosY [ 0 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) axInjectionCartoon . axis ( <str> ) axThal = plt . subplot ( gs [ 1 , 0 : 2 ] ) axThal . annotate ( <str> , xy = ( labelPosX [ 0 ] , labelPosY [ 1 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) axThal . axis ( <str> ) axThalHist = plt . subplot ( gs [ 1 , 2 ] ) axThalHist . hold ( 1 ) axThalHist . annotate ( <str> , xy = ( labelPosX [ 1 ] , labelPosY [ 1 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) extraplots . boxoff ( axThalHist ) anat036NonLemTotals = np . sum ( anat036nonLem , axis = 0 ) / ( np . sum ( anat036nonLem , axis = 0 ) + anat036ventral ) . astype ( float ) anat037NonLemTotals = np . sum ( anat037nonLem , axis = 0 ) / ( np . sum ( anat037nonLem , axis = 0 ) + anat037ventral ) . astype ( float ) anat043NonLemTotals = np . sum ( anat043nonLem , axis = 0 ) / ( np . sum ( anat043nonLem , axis = 0 ) + anat043ventral ) . astype ( float ) anat036VentralTotals = anat036ventral / ( np . sum ( anat036nonLem , axis = 0 ) + anat036ventral ) . astype ( float ) anat037VentralTotals = anat037ventral / ( np . sum ( anat037nonLem , axis = 0 ) + anat037ventral ) . astype ( float ) anat043VentralTotals = anat043ventral / ( np . sum ( anat043nonLem , axis = 0 ) + anat043ventral ) . astype ( float ) animalSplit = 0.2 jitterFrac = 0 axThalHist . plot ( jitter ( np . zeros ( len ( anat036NonLemTotals ) ) - animalSplit , 0 ) , anat036NonLemTotals , <str> , mec = anat036NonLemColor , mfc = <str> , ms = dataMS , clip_on = False ) axThalHist . plot ( jitter ( np . zeros ( len ( anat037NonLemTotals ) ) , jitterFrac ) , anat037NonLemTotals , <str> , mec = anat037NonLemColor , mfc = <str> , ms = dataMS , clip_on = False ) axThalHist . plot ( jitter ( np . zeros ( len ( anat043NonLemTotals ) ) + animalSplit , jitterFrac ) , anat043NonLemTotals , <str> , mec = anat043NonLemColor , mfc = <str> , ms = dataMS , clip_on = False ) axThalHist . plot ( jitter ( np . ones ( len ( anat036VentralTotals ) ) - animalSplit , 0 ) , anat036VentralTotals , <str> , mec = anat036VentralColor , mfc = <str> , ms = dataMS , clip_on = False ) axThalHist . plot ( jitter ( np . ones ( len ( anat037VentralTotals ) ) , jitterFrac ) , anat037VentralTotals , <str> , mec = anat037VentralColor , mfc = <str> , ms = dataMS , clip_on = False ) axThalHist . plot ( jitter ( np . ones ( len ( anat043VentralTotals ) ) + animalSplit , jitterFrac ) , anat043VentralTotals , <str> , mec = anat043VentralColor , mfc = <str> , ms = dataMS , clip_on = False ) allNonLemTotals = np . concatenate ( [ anat036NonLemTotals , anat037NonLemTotals , anat043NonLemTotals ] ) allVentralTotals = np . concatenate ( [ anat036VentralTotals , anat037VentralTotals , anat043VentralTotals ] ) nonLemMean = np . mean ( [ np . mean ( anat036NonLemTotals ) , np . mean ( anat037NonLemTotals ) , np . mean ( anat043NonLemTotals ) ] ) ventralMean = np . mean ( [ np . mean ( anat036VentralTotals ) , np . mean ( anat037VentralTotals ) , np . mean ( anat043VentralTotals ) ] ) statistic , pVal = stats . ranksums ( allNonLemTotals , allVentralTotals ) print ( <str> . format ( pVal ) ) yDataMax = max ( [ max ( allNonLemTotals ) , max ( allVentralTotals ) ] ) yStars = yDataMax + yDataMax * starYfactor yStarHeight = ( yDataMax * starYfactor ) * starHeightFactor plt . hold ( 1 ) starString = None if pVal < 0.05 else <str> extraplots . significance_stars ( [ 0 , 1 ] , yStars , yStarHeight , starMarker = <str> , starSize = fontSizeStars , starString = starString , gapFactor = starGapFactor ) plt . hold ( 1 ) medline ( nonLemMean , 0 , 0.5 , color = <str> ) medline ( ventralMean , 1 , 0.5 , color = <str> ) axThalHist . set_xlim ( [ - 0.5 , 1.5 ] ) axThalHist . set_ylabel ( <str> , fontsize = fontSizeLabels ) axThalHist . set_ylim ( [ - 0.025 , 1 ] ) axThalHist . set_yticks ( [ 0 , 1 ] ) axThalHist . set_xticks ( [ 0 , 1 ] ) axThalHist . set_yticklabels ( [ <str> , <str> ] , rotation = 90 , va = <str> ) extraplots . set_ticks_fontsize ( axThalHist , fontSizeTicks ) axThalHist . set_xticklabels ( [ <str> , <str> ] , fontsize = fontSizeLabels ) axCortex = plt . subplot ( gs [ 2 , 0 : 2 ] ) axCortex . annotate ( <str> , xy = ( labelPosX [ 0 ] , labelPosY [ 2 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) axCortex . axis ( <str> ) axCortexLayers = plt . subplot ( gs [ 2 , 2 ] ) axCortexLayers . annotate ( <str> , xy = ( labelPosX [ 1 ] , labelPosY [ 2 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) axCortexLayers . axis ( <str> ) spec = gs [ 2 , 2 ] axP = plt . subplot ( gridspec . GridSpecFromSubplotSpec ( 1 , 3 , subplot_spec = spec ) [ 2 ] ) n , bins , patches = axP . hist ( cortexCellDepths , bins = 20 , histtype = <str> , orientation = <str> , color = <str> , lw = 2 , weights = np . ones_like ( cortexCellDepths ) / float ( len ( cortexCellDepths ) ) ) axP . invert_yaxis ( ) axP . set_ylim ( [ 1 , 0 ] ) plt . show ( ) axP . spines [ <str> ] . set_visible ( False ) axP . spines [ <str> ] . set_visible ( False ) axP . set_yticks ( [ ] ) axP . set_xticks ( [ 0.16 ] ) axP . set_xticklabels ( [ <str> ] ) extraplots . set_ticks_fontsize ( axP , 10 ) axP . annotate ( <str> , xy = ( labelPosX [ 1 ] , labelPosY [ 2 ] ) , xycoords = <str> , fontsize = fontSizePanel , fontweight = <str> ) axP . set_xlabel ( <str> , fontsize = fontSizeLabels ) plt . show ( ) if SAVE_FIGURE :      extraplots . save_figure ( figFilename , figFormat , figSize , outputDir )   