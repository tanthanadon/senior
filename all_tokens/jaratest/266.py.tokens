from jaratoolbox import loadbehavior from jaratoolbox import loadopenephys from jaratoolbox import spikesanalysis from jaratoolbox import extraplots import numpy as np from pylab import * import os SAMPLING_RATE = 30000.0 timeRange = [ - 0.5 , 1 ] subject = <str> day = <str> ephysRoot = <str> fullephysRoot = ephysRoot + subject + <str> ephysSession = sort ( os . listdir ( fullephysRoot ) ) [ - 1 ] fullephysDir = os . path . join ( fullephysRoot , ephysSession ) event_filename = os . path . join ( fullephysDir , <str> ) def billyplot ( spikeTimesFromEventOnset , sortedIndexForEachSpike , meanSpikesEachFrequency , possibleFreq , responseRange , tetrodeID ) :      ax2 = plt . subplot2grid ( ( 1 , 4 ) , ( 0 , 0 ) , colspan = 3 ) plot ( spikeTimesFromEventOnset , sortedIndexForEachSpike , <str> , ms = 1 ) axvline ( x = 0 , ymin = 0 , ymax = 1 , color = <str> ) numTrials = cumsum ( numTrialsEachFreq ) for indf , num in enumerate ( numTrials ) :          ax2 . axhline ( y = num , xmin = 0 , xmax = 1 , color = <str> , zorder = 0 )  tickPositions = numTrials - mean ( numTrialsEachFreq ) / 2 tickLabels = [ <str> % ( possibleFreq [ indf ] / 1000 ) for indf in range ( len ( possibleFreq ) ) ] ax2 . set_yticks ( tickPositions ) ax2 . set_yticklabels ( tickLabels ) ylabel ( <str> . format ( numTrials [ - 1 ] ) ) title ( fullephysDir + <str> . format ( tetrodeID ) ) xlabel ( <str> ) ax2 = plt . subplot2grid ( ( 1 , 4 ) , ( 0 , 3 ) , colspan = 1 ) ax2 . set_xscale ( <str> ) plot ( possibleFreq , meanSpikesEachFrequency , <str> ) ylabel ( <str> . format ( * responseRange ) ) xlabel ( <str> ) show ( )  numTetrodes = 8 behaviorDir = <str> fullbehaviorDir = behaviorDir + subject + <str> behavName = subject + <str> + day + <str> behavDataFileName = os . path . join ( fullbehaviorDir , behavName ) bdata = loadbehavior . BehaviorData ( behavDataFileName , readmode = <str> ) freqEachTrial = bdata [ <str> ] possibleFreq = np . unique ( freqEachTrial ) numberOfTrials = len ( freqEachTrial ) sortedTrials = [ ] numTrialsEachFreq = [ ] for indf , oneFreq in enumerate ( possibleFreq ) :      indsThisFreq = np . flatnonzero ( freqEachTrial == oneFreq ) sortedTrials = np . concatenate ( ( sortedTrials , indsThisFreq ) ) numTrialsEachFreq . append ( len ( indsThisFreq ) )  sortingInds = argsort ( sortedTrials ) ev = loadopenephys . Events ( event_filename ) eventTimes = np . array ( ev . timestamps ) / SAMPLING_RATE evID = np . array ( ev . eventID ) eventOnsetTimes = eventTimes [ evID == 1 ] while ( numberOfTrials < len ( eventOnsetTimes ) ) :      eventOnsetTimes = eventOnsetTimes [ : - 1 ]  alldata = [ ] for tetrodeID in range ( 1 , numTetrodes + 1 ) :      spike_filename = os . path . join ( fullephysDir , <str> . format ( tetrodeID ) ) sp = loadopenephys . DataSpikes ( spike_filename ) try :          spkTimeStamps = np . array ( sp . timestamps ) / SAMPLING_RATE  except :          continue  ( spikeTimesFromEventOnset , trialIndexForEachSpike , indexLimitsEachTrial ) = spikesanalysis . eventlocked_spiketimes ( spkTimeStamps , eventOnsetTimes , timeRange ) sortedIndexForEachSpike = sortingInds [ trialIndexForEachSpike ] responseRange = [ 0.010 , 0.10 ] nSpikes = spikesanalysis . spiketimes_to_spikecounts ( spikeTimesFromEventOnset , indexLimitsEachTrial , responseRange ) meanSpikesEachFrequency = np . empty ( len ( possibleFreq ) ) trialsEachFreq = [ ] for indf , oneFreq in enumerate ( possibleFreq ) :          trialsEachFreq . append ( np . flatnonzero ( freqEachTrial == oneFreq ) )  for indf , oneFreq in enumerate ( possibleFreq ) :          meanSpikesEachFrequency [ indf ] = np . mean ( nSpikes [ trialsEachFreq [ indf ] ] )  alldata . append ( ( spikeTimesFromEventOnset , sortedIndexForEachSpike , meanSpikesEachFrequency , possibleFreq , responseRange , tetrodeID ) )  ft = extraplots . FlipThrough ( billyplot , alldata )  