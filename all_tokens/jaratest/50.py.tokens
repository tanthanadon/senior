from jaratoolbox import loadbehavior from jaratoolbox import loadopenephys from jaratoolbox import spikesanalysis from jaratoolbox import settings import numpy as np from pylab import * import os SAMPLING_RATE = 30000.0 timeRange = [ - 0.4 , 1.6 ] subject = sys . argv [ 1 ] if len ( sys . argv ) > 2 :      sessionInd = int ( sys . argv [ 2 ] )  else :      sessionInd = - 1  ephysRoot = os . path . join ( settings . EPHYS_PATH , subject ) ephysSession = sort ( os . listdir ( ephysRoot ) ) [ sessionInd ] ephysDir = os . path . join ( ephysRoot , ephysSession ) tetrodes = [ 3 , 4 , 5 , 6 ] nTetrodes = len ( tetrodes ) event_filename = os . path . join ( ephysDir , <str> ) ev = loadopenephys . Events ( event_filename ) eventTimes = np . array ( ev . timestamps ) / SAMPLING_RATE evID = np . array ( ev . eventID ) eventOnsetTimes = eventTimes [ evID == 1 ] clf ( ) ax = [ subplot ( nTetrodes , 1 , 1 ) ] for ind , tetrodeID in enumerate ( tetrodes ) :      spike_filename = os . path . join ( ephysDir , <str> . format ( tetrodeID ) ) sp = loadopenephys . DataSpikes ( spike_filename ) try :          spkTimeStamps = np . array ( sp . timestamps ) / SAMPLING_RATE ( spikeTimesFromEventOnset , trialIndexForEachSpike , indexLimitsEachTrial ) = spikesanalysis . eventlocked_spiketimes ( spkTimeStamps , eventOnsetTimes , timeRange ) ax . append ( subplot ( nTetrodes , 1 , ind + 1 , sharex = ax [ 0 ] ) ) plot ( spikeTimesFromEventOnset , trialIndexForEachSpike , <str> , ms = 1 ) axvline ( x = 0 , ymin = 0 , ymax = 1 , color = <str> ) xlim ( timeRange ) if ind == 0 : 	     title ( ephysDir )   except AttributeError :          pass   xlabel ( <str> ) draw ( ) show ( )  