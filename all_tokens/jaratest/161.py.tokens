from jaratoolbox import loadbehavior from jaratoolbox import settings import os import numpy as np import sys import importlib mouseName = str ( sys . argv [ 1 ] ) allcellsFileName = <str> + mouseName sys . path . append ( settings . ALLCELLS_PATH ) allcells = importlib . import_module ( allcellsFileName ) outputDir = settings . EPHYS_PATH nameOfFile = <str> minPerf = 0.60 minCorrectPerBlock = 50 minNumBlocks = 3 subject = allcells . cellDB [ 0 ] . animalName behavSession = <str> ephysSession = <str> numOfCells = len ( allcells . cellDB ) ephysRootDir = settings . EPHYS_PATH experimenter = <str> paradigm = <str> finalOutputDir = outputDir + subject + <str> minPerfList = [ ] try :      text_file = open ( <str> % ( finalOutputDir , nameOfFile ) , <str> ) text_file . readline ( ) minPerfList = text_file . read ( ) . split ( )  except :      text_file = open ( <str> % ( finalOutputDir , nameOfFile ) , <str> ) text_file . write ( <str> % minPerf )  for cellID in range ( 0 , numOfCells ) :      oneCell = allcells . cellDB [ cellID ] if ( behavSession != oneCell . behavSession ) :          subject = oneCell . animalName behavSession = oneCell . behavSession ephysSession = oneCell . ephysSession ephysRoot = os . path . join ( ephysRootDir , subject ) if ( behavSession in minPerfList ) :              continue  behaviorFilename = loadbehavior . path_to_behavior_data ( subject = subject , paradigm = paradigm , sessionstr = behavSession ) bdata = loadbehavior . BehaviorData ( behaviorFilename ) numberOfTrials = len ( bdata [ <str> ] ) correct = bdata [ <str> ] == bdata . labels [ <str> ] [ <str> ] incorrect = bdata [ <str> ] == bdata . labels [ <str> ] [ <str> ] possibleFreq = np . unique ( bdata [ <str> ] ) firstFreq = bdata [ <str> ] == possibleFreq [ 0 ] lastFreq = bdata [ <str> ] == possibleFreq [ 2 ] correctFirst = sum ( correct & firstFreq ) correctLast = sum ( correct & lastFreq ) incorrectFirst = sum ( incorrect & firstFreq ) incorrectLast = sum ( incorrect & lastFreq ) firstPerf = float ( correctFirst ) / ( correctFirst + incorrectFirst ) lastPerf = float ( correctLast ) / ( correctLast + incorrectLast ) middleFreq = bdata [ <str> ] == possibleFreq [ 1 ] highBlock = bdata [ <str> ] == bdata . labels [ <str> ] [ <str> ] lowBlock = bdata [ <str> ] == bdata . labels [ <str> ] [ <str> ] middleFreqHighBlock = middleFreq & highBlock middleFreqLowBlock = middleFreq & lowBlock correctMidHigh = sum ( middleFreqHighBlock & correct ) incorrectMidHigh = sum ( middleFreqHighBlock & incorrect ) correctMidLow = sum ( middleFreqLowBlock & correct ) incorrectMidLow = sum ( middleFreqLowBlock & incorrect ) highBlPerf = float ( correctMidHigh ) / ( correctMidHigh + incorrectMidHigh ) lowBlPerf = float ( correctMidLow ) / ( correctMidLow + incorrectMidLow ) blocks = bdata [ <str> ] highBlock = bdata . labels [ <str> ] [ <str> ] lowBlock = bdata . labels [ <str> ] [ <str> ] goodBlockCount = 0 badBlockCheck = False curBlock = blocks [ 0 ] curTrial = 0 startTrial = 0 endTrial = 0 while ( curTrial < ( len ( blocks ) - 1 ) ) :              startTrial = curTrial while ( ( curTrial < ( len ( blocks ) - 1 ) ) & ( blocks [ curTrial ] == curBlock ) ) :                  curTrial += 1  endTrial = curTrial curBlock = blocks [ curTrial ] if ( sum ( correct [ startTrial : ( endTrial + 1 ) ] ) >= minCorrectPerBlock ) :                  goodBlockCount += 1  else :                  if ( goodBlockCount < minNumBlocks ) :                      badBlockCheck = True break    if ( ( firstPerf >= minPerf ) & ( lastPerf >= minPerf ) & ( highBlPerf >= minPerf ) & ( lowBlPerf >= minPerf ) & ( goodBlockCount >= minNumBlocks ) & ( not badBlockCheck ) ) :              text_file . write ( <str> % behavSession )    text_file . close ( ) print <str>  