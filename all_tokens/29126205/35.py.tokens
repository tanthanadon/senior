import numpy as np import matplotlib . pyplot as plt import sys import healpy as hp Nside = 2048 Npix = 12 * Nside ** 2 T353file = sys . argv [ 1 ] pMLfile = sys . argv [ 2 ] psiMLfile = sys . argv [ 3 ] outputfile = sys . argv [ 4 ] T353 = hp . fitsfunc . read_map ( T353file , field = 0 ) pML = hp . pixelfunc . reorder ( hp . fitsfunc . read_map ( pMLfile , field = 0 , nest = True ) , n2r = True ) psiML = hp . pixelfunc . reorder ( hp . fitsfunc . read_map ( psiMLfile , field = 0 , nest = True ) , n2r = True ) print ( <str> ) planckpsimap = hp . pixelfunc . reorder ( hp . fitsfunc . read_map ( <str> , field = 0 , nest = True ) , n2r = True ) planckpmap = hp . pixelfunc . reorder ( hp . fitsfunc . read_map ( <str> , field = 0 , nest = True ) , n2r = True ) wherezero = np . where ( psiML == 0 ) pML [ wherezero ] = planckpmap [ wherezero ] psiML [ wherezero ] = planckpsimap [ wherezero ] P353 = pML * T353 QML = P353 * np . cos ( 2.0 * psiML ) UML = P353 * np . sin ( 2.0 * psiML ) template = np . zeros ( ( 3 , Npix ) ) template [ 0 ] = T353 template [ 1 ] = QML template [ 2 ] = UML hp . fitsfunc . write_map ( outputfile , template , coord = <str> )  