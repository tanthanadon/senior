import mock from odoo . addons . connector_carepoint . models import phone_patient from ... unit . backend_adapter import CarepointCRUDAdapter from . . common import SetUpCarepointBase _file = <str> class EndTestException ( Exception ) :      pass  class PhonePatientTestBase ( SetUpCarepointBase ) :      def setUp ( self ) :          super ( PhonePatientTestBase , self ) . setUp ( ) self . model = <str> self . mock_env = self . get_carepoint_helper ( self . model ) self . record = { <str> : 1 , <str> : 2 , }  def new_patient ( self ) :          return self . env [ <str> ] . create ( { <str> : <str> , } )   class TestPhonePatientImportMapper ( PhonePatientTestBase ) :      def setUp ( self ) :          super ( TestPhonePatientImportMapper , self ) . setUp ( ) self . Unit = phone_patient . CarepointPhonePatientImportMapper self . unit = self . Unit ( self . mock_env )  def test_partner_id_get_binder ( self ) :          with mock . patch . object ( self . unit , <str> ) :              self . unit . binder_for . side_effect = EndTestException with self . assertRaises ( EndTestException ) :                  self . unit . partner_id ( self . record )  self . unit . binder_for . assert_called_once_with ( <str> )   def test_partner_id_to_odoo ( self ) :          with mock . patch . object ( self . unit , <str> ) :              self . unit . binder_for ( ) . to_odoo . side_effect = EndTestException with self . assertRaises ( EndTestException ) :                  self . unit . partner_id ( self . record )  self . unit . binder_for ( ) . to_odoo . assert_called_once_with ( self . record [ <str> ] , browse = True , )   def test_partner_id_return ( self ) :          with mock . patch . object ( self . unit , <str> ) :              patient = self . new_patient ( ) self . unit . binder_for ( ) . to_odoo . return_value = patient res = self . unit . partner_id ( self . record ) self . assertEqual ( patient . partner_id . id , res [ <str> ] , )   def test_res_model_and_id_get_binder ( self ) :          with mock . patch . object ( self . unit , <str> ) :              self . unit . binder_for . side_effect = EndTestException with self . assertRaises ( EndTestException ) :                  self . unit . res_model_and_id ( self . record )  self . unit . binder_for . assert_called_once_with ( <str> )   def test_res_model_and_id_to_odoo ( self ) :          with mock . patch . object ( self . unit , <str> ) :              self . unit . binder_for ( ) . to_odoo . side_effect = EndTestException with self . assertRaises ( EndTestException ) :                  self . unit . res_model_and_id ( self . record )  self . unit . binder_for ( ) . to_odoo . assert_called_once_with ( self . record [ <str> ] , browse = True , )   def test_res_model_and_id_return_model ( self ) :          with mock . patch . object ( self . unit , <str> ) :              patient = self . new_patient ( ) self . unit . binder_for ( ) . to_odoo . return_value = patient res = self . unit . res_model_and_id ( self . record ) self . assertEqual ( patient . _name , res [ <str> ] , )   def test_res_model_and_id_return_id ( self ) :          with mock . patch . object ( self . unit , <str> ) :              patient = self . new_patient ( ) self . unit . binder_for ( ) . to_odoo . return_value = patient res = self . unit . res_model_and_id ( self . record ) self . assertEqual ( patient . id , res [ <str> ] , )   def test_carepoint_id ( self ) :          res = self . unit . carepoint_id ( self . record ) expect = { <str> : <str> % ( self . record [ <str> ] , self . record [ <str> ] , ) , } self . assertDictEqual ( expect , res )   class TestPhonePatientImporter ( PhonePatientTestBase ) :      def setUp ( self ) :          super ( TestPhonePatientImporter , self ) . setUp ( ) self . Unit = phone_patient . CarepointPhonePatientImporter self . unit = self . Unit ( self . mock_env ) self . unit . carepoint_record = self . record  @ mock . patch ( <str> % _file , spec = phone_patient . CarepointPhoneAbstractImporter , ) def test_import_dependencies_import ( self , _super ) :          with mock . patch . object ( self . unit , <str> ) as mk :              self . unit . _import_dependencies ( ) mk . assert_has_calls ( [ mock . call ( self . record [ <str> ] , <str> , ) , ] )    class TestCarepointPhonePatientUnit ( PhonePatientTestBase ) :      def setUp ( self ) :          super ( TestCarepointPhonePatientUnit , self ) . setUp ( ) self . Unit = phone_patient . CarepointPhonePatientUnit self . unit = self . Unit ( self . mock_env )  def test_import_phones_unit ( self ) :          with mock . patch . object ( self . unit , <str> ) as mk :              mk . side_effect = [ None , EndTestException ] with self . assertRaises ( EndTestException ) :                  self . unit . _import_phones ( None , None )  mk . assert_has_calls ( [ mock . call ( CarepointCRUDAdapter ) , mock . call ( phone_patient . CarepointPhonePatientImporter , ) , ] )   def test_import_phones_search ( self ) :          patient = mock . MagicMock ( ) with mock . patch . object ( self . unit , <str> ) as mk :              self . unit . _import_phones ( patient , None ) mk ( ) . search . assert_called_once_with ( pat_id = patient , )   def test_import_phones_import ( self ) :          expect = mock . MagicMock ( ) with mock . patch . object ( self . unit , <str> ) as mk :              mk ( ) . search . return_value = [ expect ] self . unit . _import_phones ( 1 , None ) mk ( ) . run . assert_called_once_with ( expect )    class TestPhonePatientExportMapper ( PhonePatientTestBase ) :      def setUp ( self ) :          super ( TestPhonePatientExportMapper , self ) . setUp ( ) self . Unit = phone_patient . CarepointPhonePatientExportMapper self . unit = self . Unit ( self . mock_env ) self . record = mock . MagicMock ( )  def test_pat_id_get_binder ( self ) :          with mock . patch . object ( self . unit , <str> ) :              self . unit . binder_for . side_effect = EndTestException with self . assertRaises ( EndTestException ) :                  self . unit . pat_id ( self . record )  self . unit . binder_for . assert_called_once_with ( <str> )   def test_pat_id_to_backend ( self ) :          with mock . patch . object ( self . unit , <str> ) :              self . unit . binder_for ( ) . to_backend . side_effect = EndTestException with self . assertRaises ( EndTestException ) :                  self . unit . pat_id ( self . record )  self . unit . binder_for ( ) . to_backend . assert_called_once_with ( self . record . res_id , )   def test_pat_id_return ( self ) :          with mock . patch . object ( self . unit , <str> ) :              res = self . unit . pat_id ( self . record ) expect = self . unit . binder_for ( ) . to_backend ( ) self . assertDictEqual ( { <str> : expect } , res )     