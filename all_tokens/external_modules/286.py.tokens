from openerp import models , fields , api class SaleOrderLine ( models . Model ) :      _inherit = <str> @ api . one @ api . depends ( <str> , <str> , <str> , <str> ) def _product_margin ( self ) :          self . margin = 0.0 self . margin_perc = 0.0 self . purchase_price = 0.0 c = self . _context . copy ( ) c . update ( company_id = self . order_id . company_id . id , force_company = self . order_id . company_id . id ) t_product = self . env [ <str> ] . with_context ( c ) product = False if self . product_id :              product = t_product . browse ( self . product_id . id )  if product and product . standard_price :              self . purchase_price = product . standard_price sale_price = self . price_unit * self . product_uom_qty * ( ( 100.0 - self . discount ) / 100.0 ) purchase_price = self . purchase_price * self . product_uom_qty margin = round ( sale_price - purchase_price , 2 ) if sale_price :                  self . margin_perc = round ( ( margin * 100 ) / sale_price , 2 )  self . margin = margin   margin = fields . Float ( compute = <str> , string = <str> , store = True , multi = <str> , readonly = True ) margin_perc = fields . Float ( compute = <str> , string = <str> , store = True , multi = <str> , readonly = True ) purchase_price = fields . Float ( compute = <str> , readonly = True , string = <str> , store = True , multi = <str> )  class SaleOrder ( models . Model ) :      _inherit = <str> @ api . one @ api . depends ( <str> ) def _product_margin ( self ) :          total_purchase = self . total_purchase self . margin = 0.0 sale_price = margin = 0.0 if total_purchase != 0 :              for line in self . order_line :                  margin += line . margin or 0.0 sale_price += line . price_subtotal  self . margin = round ( margin , 2 ) if sale_price :                  self . margin_perc = round ( ( margin * 100 ) / sale_price , 2 )    @ api . one def _get_total_price_purchase ( self ) :          self . total_purchase = 0.0 for line in self . order_line :              if line . purchase_price :                  self . total_purchase += line . purchase_price * line . product_uom_qty  elif line . product_id :                  c = self . _context . copy ( ) c . update ( company_id = self . company_id . id , force_company = self . company_id . id ) t_product = self . env [ <str> ] . with_context ( c ) product = t_product . browse ( self . product_id . id ) cost_price = product . standard_price self . total_purchase += cost_price * line . product_uom_qty    total_purchase = fields . Float ( compute = <str> , string = <str> , readonly = False ) margin = fields . Float ( compute = <str> , string = <str> , help = <str> <str> , store = True , readonly = True ) margin_perc = fields . Float ( compute = <str> , string = <str> , store = True , readonly = True )   