from __future__ import print_function import tensorflow as tf import odl import odl . contrib . tensorflow sess = tf . InteractiveSession ( ) space = odl . uniform_discr ( [ 0 , 0 ] , [ 1 , 1 ] , [ 10 , 10 ] , dtype = <str> ) odl_op = odl . Gradient ( space ) x = odl_op . domain . one ( ) z = odl_op . range . one ( ) x_tf = tf . ones ( [ 1 , 10 , 10 , 1 ] ) z_tf = tf . ones ( [ 1 , 2 , 10 , 10 , 1 ] ) odl_op_layer = odl . contrib . tensorflow . as_tensorflow_layer ( odl_op , <str> ) y_tf = odl_op_layer ( x_tf ) print ( <str> ) print ( y_tf . eval ( ) . squeeze ( ) ) print ( <str> ) print ( odl_op ( x ) ) scale = 1 / space . cell_volume print ( <str> ) print ( tf . gradients ( y_tf , [ x_tf ] , z_tf ) [ 0 ] . eval ( ) . squeeze ( ) * scale ) print ( <str> ) print ( odl_op . derivative ( x ) . adjoint ( z ) )  