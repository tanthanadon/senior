import matplotlib . pyplot as plt import numpy as np import odl impl = None shift = np . array ( [ 0.0 , 25.0 , 0.0 ] ) vol_shape = ( 100 , 150 , 200 ) vol_max_pt = np . array ( vol_shape , dtype = float ) / 2 vol_min_pt = - vol_max_pt reco_space = odl . uniform_discr ( vol_min_pt + shift , vol_max_pt + shift , vol_shape , dtype = <str> ) phantom = odl . phantom . indicate_proj_axis ( reco_space ) assert np . allclose ( reco_space . cell_sides , 1 ) grid = odl . RectGrid ( [ 0 , np . pi / 2 , np . pi , 3 * np . pi / 2 ] ) angle_partition = odl . uniform_partition_fromgrid ( grid ) det_size = np . floor ( 1.1 * np . sqrt ( np . sum ( np . square ( vol_shape ) ) ) ) det_shape = ( int ( det_size ) , int ( det_size ) ) det_max_pt = np . array ( [ det_size / 2 , det_size / 2 ] ) det_min_pt = - det_max_pt detector_partition = odl . uniform_partition ( det_min_pt , det_max_pt , det_shape ) assert np . allclose ( detector_partition . cell_sides , 1 ) sum_along_x = np . sum ( phantom , axis = 0 ) sum_along_y = np . sum ( phantom , axis = 1 ) sum_along_z = np . sum ( phantom , axis = 2 ) geometry = odl . tomo . Parallel3dAxisGeometry ( angle_partition , detector_partition , axis = [ 0 , 0 , 1 ] ) assert np . allclose ( geometry . det_axes_init [ 0 ] , [ 1 , 0 , 0 ] ) assert np . allclose ( geometry . det_axes_init [ 1 ] , [ 0 , 0 , 1 ] ) assert np . allclose ( geometry . det_pos_init , [ 0 , 1 , 0 ] ) ray_trafo = odl . tomo . RayTransform ( reco_space , geometry , impl = impl ) proj_data = ray_trafo ( phantom ) proj_data . show ( indices = [ 0 , None , None ] , title = <str> ) sum_along_y . show ( <str> ) axes_sum_y = geometry . det_axes ( np . deg2rad ( 0 ) ) assert np . allclose ( axes_sum_y [ 0 ] , [ 1 , 0 , 0 ] ) assert np . allclose ( axes_sum_y [ 1 ] , [ 0 , 0 , 1 ] ) proj_data . show ( indices = [ 1 , None , None ] , title = <str> ) sum_along_x . show ( <str> ) axes_sum_x = geometry . det_axes ( np . deg2rad ( 90 ) ) assert np . allclose ( axes_sum_x [ 0 ] , [ 0 , 1 , 0 ] ) assert np . allclose ( axes_sum_x [ 1 ] , [ 0 , 0 , 1 ] ) geometry = odl . tomo . Parallel3dAxisGeometry ( angle_partition , detector_partition , axis = [ 0 , 1 , 0 ] ) assert np . allclose ( geometry . det_axes_init [ 0 ] , [ 1 , 0 , 0 ] ) assert np . allclose ( geometry . det_axes_init [ 1 ] , [ 0 , 1 , 0 ] ) assert np . allclose ( geometry . det_pos_init , [ 0 , 0 , - 1 ] ) ray_trafo = odl . tomo . RayTransform ( reco_space , geometry , impl = impl ) proj_data = ray_trafo ( phantom ) proj_data . show ( indices = [ 0 , None , None ] , title = <str> ) sum_along_z . show ( <str> ) axes_sum_z = geometry . det_axes ( np . deg2rad ( 0 ) ) assert np . allclose ( axes_sum_z [ 0 ] , [ 1 , 0 , 0 ] ) assert np . allclose ( axes_sum_z [ 1 ] , [ 0 , 1 , 0 ] ) proj_data . show ( indices = [ 3 , None , None ] , title = <str> ) fig , ax = plt . subplots ( ) ax . imshow ( sum_along_x , cmap = <str> , origin = <str> ) ax . set_xlabel ( <str> ) ax . set_ylabel ( <str> ) plt . title ( <str> ) plt . show ( ) axes_sum_x_T = geometry . det_axes ( np . deg2rad ( 270 ) ) assert np . allclose ( axes_sum_x_T [ 0 ] , [ 0 , 0 , 1 ] ) assert np . allclose ( axes_sum_x_T [ 1 ] , [ 0 , 1 , 0 ] ) geometry = odl . tomo . Parallel3dAxisGeometry ( angle_partition , detector_partition , axis = [ 1 , 0 , 0 ] ) assert np . allclose ( geometry . det_axes_init [ 0 ] , [ 0 , 0 , - 1 ] ) assert np . allclose ( geometry . det_axes_init [ 1 ] , [ 1 , 0 , 0 ] ) assert np . allclose ( geometry . det_pos_init , [ 0 , 1 , 0 ] ) ray_trafo = odl . tomo . RayTransform ( reco_space , geometry , impl = impl ) proj_data = ray_trafo ( phantom ) proj_data . show ( indices = [ 1 , None , None ] , title = <str> ) fig , ax = plt . subplots ( ) ax . imshow ( sum_along_z , cmap = <str> , origin = <str> ) ax . set_xlabel ( <str> ) ax . set_ylabel ( <str> ) plt . title ( <str> ) plt . show ( ) axes_sum_z_T = geometry . det_axes ( np . deg2rad ( 90 ) ) assert np . allclose ( axes_sum_z_T [ 0 ] , [ 0 , 1 , 0 ] ) assert np . allclose ( axes_sum_z_T [ 1 ] , [ 1 , 0 , 0 ] ) proj_data . show ( indices = [ 2 , None , None ] , title = <str> ) fig , ax = plt . subplots ( ) ax . imshow ( sum_along_y , cmap = <str> , origin = <str> ) ax . set_xlabel ( <str> ) ax . set_ylabel ( <str> ) plt . title ( <str> ) plt . show ( ) axes_sum_y = geometry . det_axes ( np . deg2rad ( 180 ) ) assert np . allclose ( axes_sum_y [ 0 ] , [ 0 , 0 , 1 ] ) assert np . allclose ( axes_sum_y [ 1 ] , [ 1 , 0 , 0 ] )  